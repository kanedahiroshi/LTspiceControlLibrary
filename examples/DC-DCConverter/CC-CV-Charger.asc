Version 4
SHEET 1 3572 852
WIRE 560 0 432 0
WIRE 752 0 640 0
WIRE 800 0 752 0
WIRE 944 0 880 0
WIRE 1056 0 944 0
WIRE 1088 0 1056 0
WIRE 432 32 432 0
WIRE 752 48 752 0
WIRE 944 48 944 0
WIRE 432 176 432 112
WIRE 752 176 752 112
WIRE 752 176 432 176
WIRE 944 176 944 112
WIRE 944 176 752 176
WIRE 1088 176 1088 160
WIRE 1088 176 944 176
WIRE 432 192 432 176
WIRE 640 352 608 352
WIRE 672 352 640 352
WIRE 784 352 736 352
WIRE 880 352 864 352
WIRE 976 352 944 352
WIRE 1040 352 976 352
WIRE 1072 352 1040 352
WIRE 1168 352 1136 352
WIRE 1184 352 1168 352
WIRE 976 400 976 352
WIRE 992 400 976 400
WIRE 1072 400 1056 400
WIRE 1104 400 1104 384
WIRE 1104 400 1072 400
WIRE 1216 400 1216 384
WIRE 608 416 608 352
WIRE 1216 416 1216 400
WIRE 480 576 448 576
WIRE 672 576 480 576
WIRE 816 576 816 384
WIRE 816 576 800 576
WIRE 576 624 544 624
WIRE 592 624 576 624
WIRE 704 624 704 608
WIRE 704 624 688 624
WIRE 448 640 448 576
WIRE 544 640 544 624
FLAG 432 192 0
FLAG 576 48 X
FLAG 624 48 0
FLAG 432 0 IN
FLAG 1056 0 OUT
FLAG 1248 352 X
FLAG 608 496 0
FLAG 704 384 OUT
FLAG 640 352 v*
FLAG 1040 352 m*_p
FLAG 1072 400 m*_i
FLAG 1168 352 m*
FLAG 448 720 0
FLAG 480 576 i*
FLAG 544 720 0
FLAG 576 624 i
FLAG 1216 496 0
FLAG 1216 400 c
FLAG 1216 656 0
SYMBOL voltage 432 16 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value 10
SYMBOL cap 928 48 R0
SYMATTR InstName C1
SYMATTR Value 10u
SYMBOL diode 768 112 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL ind 784 16 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 47u
SYMBOL sw 656 0 M270
SYMATTR InstName S1
SYMBOL voltage 608 400 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value 4
SYMBOL sub 688 384 R0
SYMATTR InstName U1
SYMBOL Integral 1008 432 R0
SYMATTR Value T=0.1m
SYMATTR InstName U2
SYMBOL nle 1200 384 R0
SYMATTR InstName U3
SYMBOL Proportional 896 384 R0
SYMATTR InstName U4
SYMBOL add 1088 384 R0
SYMATTR InstName U5
SYMBOL TriangleWaveVoltage 1216 400 R0
SYMATTR InstName U6
SYMATTR Value V1=0 V2=1 Tperiod={1/200k} tratio=1
SYMBOL bv 1088 64 R0
SYMATTR InstName B1
SYMATTR Value V=idt(I(B1))/0.5+3.8
SYMBOL voltage 448 624 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value 2
SYMBOL sub 688 608 R0
SYMATTR InstName U10
SYMBOL res 1072 -16 R0
SYMATTR InstName R1
SYMATTR Value 50m
SYMBOL bv 544 624 R0
SYMATTR InstName B2
SYMATTR Value V=I(L1)
SYMBOL LTspiceControlLibrary\\Math\\Functions\\min 800 384 R0
SYMATTR InstName U17
SYMBOL Proportional 752 608 R0
SYMATTR InstName U7
SYMBOL LTspiceControlLibrary\\TransferFunctions\\1stOrderLag 608 656 R0
SYMATTR Value K=1 T=10u
SYMATTR InstName U8
SYMBOL bv 1216 560 R0
SYMATTR InstName B3
SYMATTR Value V=V(m*)>V(c) tripdt={1m/200k}
TEXT 408 -200 Left 2 !.tran 100m startup
TEXT 408 -168 Left 2 !.model SW SW(Ron=.1 Roff=1Meg Vt=0.5)\n.model D D(Ron=.1 Roff=1Meg Vfwd=.4)
TEXT 352 264 Left 4 ;Controller
TEXT 1184 296 Left 2 ;PWM
TEXT 360 -248 Left 4 ;Config
TEXT 320 -304 Left 5 ;Constant Current / Constant Voltage Battery Charger
TEXT 360 -88 Left 4 ;Circuit
TEXT 1168 80 Left 2 ;battery
TEXT 664 -64 Left 2 ;buck converter
TEXT 1256 608 Left 2 ;simulation time step adjustment
TEXT 600 304 Left 2 ;CV controller
TEXT 448 536 Left 2 ;CC controller
