Version 4
SHEET 1 4052 3348
WIRE -1968 -1024 -2208 -1024
WIRE -1712 -1024 -1968 -1024
WIRE -1488 -1024 -1712 -1024
WIRE -1968 -992 -1968 -1024
WIRE -1888 -992 -1968 -992
WIRE -1712 -992 -1712 -1024
WIRE -1632 -992 -1712 -992
WIRE -1488 -992 -1488 -1024
WIRE -1408 -992 -1488 -992
WIRE -1968 -976 -1968 -992
WIRE -1888 -976 -1888 -992
WIRE -1712 -976 -1712 -992
WIRE -1632 -976 -1632 -992
WIRE -1488 -976 -1488 -992
WIRE -1408 -976 -1408 -992
WIRE -1968 -880 -1968 -896
WIRE -1888 -880 -1888 -912
WIRE -1888 -880 -1968 -880
WIRE -1712 -880 -1712 -896
WIRE -1632 -880 -1632 -912
WIRE -1632 -880 -1712 -880
WIRE -1488 -880 -1488 -896
WIRE -1408 -880 -1408 -912
WIRE -1408 -880 -1488 -880
WIRE -2208 -832 -2208 -1024
WIRE -1968 -832 -1968 -880
WIRE -1456 -832 -1968 -832
WIRE -1392 -832 -1456 -832
WIRE -1248 -832 -1328 -832
WIRE -1088 -832 -1120 -832
WIRE -960 -832 -992 -832
WIRE -944 -832 -960 -832
WIRE -944 -816 -944 -832
WIRE -1712 -784 -1712 -880
WIRE -1456 -784 -1712 -784
WIRE -1248 -784 -1456 -784
WIRE -1072 -768 -1072 -784
WIRE -1040 -768 -1040 -784
WIRE -1008 -768 -1008 -784
WIRE -1488 -736 -1488 -880
WIRE -1456 -736 -1488 -736
WIRE -1392 -736 -1456 -736
WIRE -1248 -736 -1328 -736
WIRE -1104 -736 -1120 -736
WIRE -1104 -720 -1104 -736
WIRE -944 -720 -944 -736
WIRE -944 -720 -1104 -720
WIRE -1968 -704 -1968 -832
WIRE -1888 -704 -1968 -704
WIRE -1712 -704 -1712 -784
WIRE -1632 -704 -1712 -704
WIRE -1488 -704 -1488 -736
WIRE -1408 -704 -1488 -704
WIRE -1968 -688 -1968 -704
WIRE -1712 -688 -1712 -704
WIRE -1488 -688 -1488 -704
WIRE -1888 -672 -1888 -704
WIRE -1632 -672 -1632 -704
WIRE -1408 -672 -1408 -704
WIRE -1104 -672 -1104 -720
WIRE -1968 -592 -1968 -608
WIRE -1888 -592 -1888 -608
WIRE -1888 -592 -1968 -592
WIRE -1712 -592 -1712 -608
WIRE -1632 -592 -1632 -608
WIRE -1632 -592 -1712 -592
WIRE -1488 -592 -1488 -608
WIRE -1408 -592 -1408 -608
WIRE -1408 -592 -1488 -592
WIRE -1968 -560 -1968 -592
WIRE -1968 -560 -2000 -560
WIRE -1712 -560 -1712 -592
WIRE -1712 -560 -1744 -560
WIRE -1488 -560 -1488 -592
WIRE -1488 -560 -1536 -560
WIRE -1968 -544 -1968 -560
WIRE -1712 -544 -1712 -560
WIRE -1488 -544 -1488 -560
WIRE -2208 -432 -2208 -752
WIRE -1968 -432 -1968 -464
WIRE -1968 -432 -2208 -432
WIRE -1712 -432 -1712 -464
WIRE -1712 -432 -1968 -432
WIRE -1488 -432 -1488 -464
WIRE -1488 -432 -1712 -432
WIRE -2208 -400 -2208 -432
WIRE -1936 -352 -1952 -352
WIRE -1920 -352 -1936 -352
WIRE -1616 -352 -1632 -352
WIRE -1600 -352 -1616 -352
WIRE -1248 -352 -1264 -352
WIRE -1232 -352 -1248 -352
WIRE -1936 -336 -1936 -352
WIRE -1248 -336 -1248 -352
WIRE -1616 -288 -1616 -352
WIRE -2208 -272 -2224 -272
WIRE -2192 -272 -2208 -272
WIRE -2208 -256 -2208 -272
WIRE -2032 -224 -2048 -224
WIRE -1936 -224 -1936 -256
WIRE -1936 -224 -1952 -224
WIRE -1920 -224 -1936 -224
WIRE -1872 -224 -1920 -224
WIRE -1344 -224 -1376 -224
WIRE -1248 -224 -1248 -256
WIRE -1248 -224 -1264 -224
WIRE -1232 -224 -1248 -224
WIRE -1184 -224 -1232 -224
WIRE -1920 -208 -1920 -224
WIRE -1232 -208 -1232 -224
WIRE -1712 -176 -1728 -176
WIRE -1616 -176 -1616 -208
WIRE -1616 -176 -1632 -176
WIRE -1600 -176 -1616 -176
WIRE -1552 -176 -1600 -176
WIRE -992 -176 -1008 -176
WIRE -880 -176 -912 -176
WIRE -800 -176 -880 -176
WIRE -752 -176 -800 -176
WIRE -1600 -160 -1600 -176
WIRE -880 -160 -880 -176
WIRE -800 -160 -800 -176
WIRE -880 -64 -880 -80
WIRE -800 -64 -800 -96
WIRE -800 -64 -880 -64
WIRE -1920 -48 -1920 -144
WIRE -1600 -48 -1600 -96
WIRE -1232 -48 -1232 -144
WIRE -880 -48 -880 -64
WIRE 384 352 368 352
WIRE -2096 384 -2112 384
WIRE -1968 384 -2032 384
WIRE -1888 384 -1904 384
WIRE -1712 384 -1808 384
WIRE -176 384 -368 384
WIRE -1712 416 -1728 416
WIRE -176 416 -192 416
WIRE -1424 432 -1536 432
WIRE -1312 432 -1360 432
WIRE -1232 432 -1248 432
WIRE 32 432 0 432
WIRE 48 432 32 432
WIRE 288 432 112 432
WIRE 368 432 368 352
WIRE 368 432 352 432
WIRE 448 432 368 432
WIRE -1712 448 -1792 448
WIRE -192 448 -400 448
WIRE -176 448 -192 448
WIRE -736 480 -768 480
WIRE -624 480 -736 480
WIRE -544 480 -560 480
WIRE -400 480 -400 448
WIRE -400 480 -416 480
WIRE 32 512 32 432
WIRE -736 528 -736 480
WIRE -720 528 -736 528
WIRE -640 528 -656 528
WIRE -592 528 -592 512
WIRE -592 528 -640 528
WIRE -368 544 -368 384
WIRE -176 544 -368 544
WIRE 0 544 -176 544
WIRE 80 544 64 544
WIRE 208 544 192 544
WIRE 288 544 272 544
WIRE 448 544 352 544
WIRE -368 560 -368 544
WIRE -2096 576 -2112 576
WIRE -1968 576 -2032 576
WIRE -1888 576 -1904 576
WIRE -1712 576 -1808 576
WIRE -736 592 -768 592
WIRE -624 592 -736 592
WIRE -512 592 -512 512
WIRE -512 592 -560 592
WIRE -1712 608 -1728 608
WIRE -1424 624 -1536 624
WIRE -1312 624 -1360 624
WIRE -1232 624 -1248 624
WIRE -1792 640 -1792 448
WIRE -1712 640 -1792 640
WIRE -736 640 -736 592
WIRE -720 640 -736 640
WIRE -640 640 -656 640
WIRE -592 640 -592 624
WIRE -592 640 -640 640
WIRE -272 672 -288 672
WIRE -192 672 -192 448
WIRE -192 672 -208 672
WIRE -736 704 -768 704
WIRE -624 704 -736 704
WIRE -448 704 -448 512
WIRE -448 704 -560 704
WIRE 0 736 -64 736
WIRE 240 736 240 576
WIRE 240 736 0 736
WIRE -736 752 -736 704
WIRE -720 752 -736 752
WIRE -640 752 -656 752
WIRE -592 752 -592 736
WIRE -592 752 -640 752
WIRE -64 752 -64 736
WIRE -2096 768 -2112 768
WIRE -1968 768 -2032 768
WIRE -1888 768 -1904 768
WIRE -1712 768 -1808 768
WIRE -1712 800 -1728 800
WIRE -1424 816 -1536 816
WIRE -1312 816 -1360 816
WIRE -1232 816 -1248 816
WIRE -1792 832 -1792 640
WIRE -1712 832 -1792 832
WIRE -1968 960 -2112 960
WIRE -1888 960 -1904 960
WIRE -1712 960 -1808 960
WIRE -1712 992 -1728 992
WIRE -1424 1008 -1536 1008
WIRE -1232 1008 -1360 1008
WIRE -1792 1024 -1792 832
WIRE -1712 1024 -1792 1024
WIRE -1792 1088 -1792 1024
WIRE 496 1296 480 1296
WIRE 576 1296 560 1296
WIRE 928 1296 640 1296
WIRE 960 1296 928 1296
WIRE 496 1328 480 1328
WIRE 576 1328 560 1328
WIRE 784 1360 640 1360
WIRE 816 1360 784 1360
WIRE -432 1408 -512 1408
WIRE 528 1408 528 1376
WIRE 544 1408 528 1408
WIRE 640 1408 608 1408
WIRE 816 1408 816 1360
WIRE 960 1408 960 1296
WIRE -432 1440 -448 1440
WIRE -240 1456 -256 1456
WIRE -432 1472 -480 1472
WIRE -1600 1520 -1632 1520
WIRE -1584 1520 -1600 1520
WIRE -1504 1520 -1520 1520
WIRE -1376 1520 -1440 1520
WIRE -1296 1520 -1376 1520
WIRE -1264 1520 -1296 1520
WIRE -1152 1520 -1200 1520
WIRE -1632 1568 -1632 1520
WIRE -1376 1568 -1376 1520
WIRE -1296 1568 -1312 1568
WIRE -1232 1568 -1232 1552
WIRE -1232 1568 -1296 1568
WIRE 48 1568 32 1568
WIRE -864 1584 -896 1584
WIRE -800 1584 -864 1584
WIRE -720 1584 -736 1584
WIRE -544 1584 -608 1584
WIRE -512 1584 -512 1408
WIRE -512 1584 -544 1584
WIRE -240 1584 -240 1456
WIRE -176 1584 -240 1584
WIRE -128 1584 -176 1584
WIRE -432 1600 -512 1600
WIRE 48 1600 32 1600
WIRE 608 1600 592 1600
WIRE 656 1600 608 1600
WIRE 736 1600 720 1600
WIRE 752 1600 736 1600
WIRE 832 1600 816 1600
WIRE 912 1600 832 1600
WIRE 960 1600 912 1600
WIRE -1152 1616 -1152 1520
WIRE -1120 1616 -1152 1616
WIRE -1104 1616 -1120 1616
WIRE -1024 1616 -1040 1616
WIRE -896 1616 -896 1584
WIRE -896 1616 -960 1616
WIRE -768 1616 -816 1616
WIRE -432 1632 -448 1632
WIRE 48 1632 32 1632
WIRE -1120 1648 -1152 1648
WIRE -1104 1648 -1120 1648
WIRE -1024 1648 -1040 1648
WIRE -864 1648 -960 1648
WIRE -800 1648 -864 1648
WIRE -720 1648 -736 1648
WIRE -544 1648 -608 1648
WIRE -512 1648 -512 1600
WIRE -512 1648 -544 1648
WIRE -176 1648 -256 1648
WIRE -128 1648 -176 1648
WIRE -480 1664 -480 1472
WIRE -432 1664 -480 1664
WIRE 48 1664 32 1664
WIRE 960 1664 960 1600
WIRE -896 1680 -960 1680
WIRE -816 1680 -816 1616
WIRE -768 1680 -816 1680
WIRE 832 1680 832 1600
WIRE 832 1680 720 1680
WIRE 48 1696 32 1696
WIRE -896 1712 -896 1680
WIRE -864 1712 -896 1712
WIRE -800 1712 -864 1712
WIRE -720 1712 -736 1712
WIRE -544 1712 -608 1712
WIRE -512 1712 -544 1712
WIRE -176 1712 -240 1712
WIRE -128 1712 -176 1712
WIRE -2224 1728 -2240 1728
WIRE -2208 1728 -2224 1728
WIRE -2128 1728 -2144 1728
WIRE -2000 1728 -2064 1728
WIRE -1936 1728 -2000 1728
WIRE -1904 1728 -1936 1728
WIRE -1824 1728 -1840 1728
WIRE -1808 1728 -1824 1728
WIRE -1648 1728 -1744 1728
WIRE -1632 1728 -1648 1728
WIRE -1504 1728 -1568 1728
WIRE -1376 1728 -1440 1728
WIRE -1296 1728 -1376 1728
WIRE -1264 1728 -1296 1728
WIRE -1152 1728 -1152 1648
WIRE -1152 1728 -1200 1728
WIRE 48 1728 32 1728
WIRE -816 1744 -816 1680
WIRE -768 1744 -816 1744
WIRE -816 1760 -816 1744
WIRE -2240 1776 -2240 1728
WIRE -2000 1776 -2000 1728
WIRE -1984 1776 -2000 1776
WIRE -1904 1776 -1920 1776
WIRE -1872 1776 -1872 1760
WIRE -1872 1776 -1904 1776
WIRE -1376 1776 -1376 1728
WIRE -1296 1776 -1312 1776
WIRE -1232 1776 -1232 1760
WIRE -1232 1776 -1296 1776
WIRE -512 1792 -512 1712
WIRE -432 1792 -512 1792
WIRE -1072 1808 -1072 1696
WIRE -944 1808 -1072 1808
WIRE -432 1824 -448 1824
WIRE -1552 1840 -1552 1552
WIRE -1120 1840 -1552 1840
WIRE -1104 1840 -1120 1840
WIRE -1024 1840 -1040 1840
WIRE -880 1840 -960 1840
WIRE -240 1840 -240 1712
WIRE -240 1840 -256 1840
WIRE -480 1856 -480 1664
WIRE -432 1856 -480 1856
WIRE -1600 1872 -1600 1760
WIRE -1120 1872 -1600 1872
WIRE -1104 1872 -1120 1872
WIRE -1024 1872 -1040 1872
WIRE -880 1904 -960 1904
WIRE -480 1936 -480 1856
WIRE -1072 1952 -1072 1920
WIRE -1056 1952 -1072 1952
WIRE -944 1952 -944 1808
WIRE -944 1952 -992 1952
WIRE -880 1952 -944 1952
WIRE -2176 2000 -2176 1760
WIRE -880 2000 -2176 2000
FLAG -2208 -400 0
FLAG -2016 -960 UP
FLAG -2016 -912 0
FLAG -1456 -832 U
FLAG -2016 -672 UN
FLAG -2016 -624 0
FLAG -1760 -960 VP
FLAG -1760 -912 0
FLAG -1760 -672 VN
FLAG -1760 -624 0
FLAG -1456 -784 V
FLAG -2208 -1024 VDC
FLAG 48 1568 UP
FLAG 48 1664 VN
FLAG 48 1600 UN
FLAG 48 1632 VP
FLAG -1536 -960 WP
FLAG -1536 -912 0
FLAG -1536 -672 WN
FLAG -1536 -624 0
FLAG -1456 -736 W
FLAG 48 1728 WN
FLAG 48 1696 WP
FLAG -944 1760 vpn_adc
FLAG -864 1584 vu*
FLAG -864 1648 vv*
FLAG -864 1712 vw*
FLAG -544 1584 mu*
FLAG -544 1648 mv*
FLAG -544 1712 mw*
FLAG -1104 -672 0
FLAG -960 -832 tm
FLAG -2208 -176 0
FLAG -2208 -272 AVCC
FLAG -1920 -48 0
FLAG -1936 -352 AVCC
FLAG -1872 -224 IU_R_AIN
FLAG -1600 -48 0
FLAG -1616 -352 AVCC
FLAG -1552 -176 IV_R_AIN
FLAG -1232 -48 0
FLAG -1248 -352 AVCC
FLAG -1184 -224 IW_R_AIN
FLAG -880 -48 0
FLAG -752 -176 VDC_AIN
FLAG -1008 -176 VDC
FLAG -2000 -560 IU_OUT
FLAG -1744 -560 IV_OUT
FLAG -1536 -560 IW_OUT
FLAG -1376 -224 IW_OUT
FLAG -1728 -176 IV_OUT
FLAG -2048 -224 IU_OUT
FLAG -1728 416 0
FLAG -1792 1168 0
FLAG -1728 608 0
FLAG -1728 800 0
FLAG -2112 384 IU_R_AIN
FLAG -1728 992 0
FLAG -2112 576 IV_R_AIN
FLAG -2112 768 IW_R_AIN
FLAG -2112 960 VDC_AIN
FLAG -1232 432 iu_adc
FLAG -1232 624 iv_adc
FLAG -1232 816 iw_adc
FLAG -1232 1008 vpn_adc
FLAG -1072 -768 hu
FLAG -1040 -768 hv
FLAG -1008 -768 hw
FLAG -768 480 hu
FLAG -768 592 hv
FLAG -768 704 hw
FLAG -288 672 clear
FLAG -368 720 0
FLAG -176 544 counter
FLAG -64 832 0
FLAG 0 736 base_position
FLAG -192 416 0
FLAG -640 528 hud
FLAG -640 640 hvd
FLAG -640 752 hwd
FLAG 448 432 oe_hs
FLAG 448 544 pe_hs
FLAG 448 352 om_hs
FLAG 960 1488 0
FLAG 816 1488 0
FLAG -880 1840 iu_adc
FLAG -880 1904 iw_adc
FLAG -1120 1840 id
FLAG -1120 1872 iq
FLAG -1600 1520 id*
FLAG -1296 1520 vd*_p
FLAG -1296 1568 vd*_i
FLAG -1632 1648 0
FLAG -1648 1728 iq*
FLAG -1296 1728 vq*_p
FLAG -1296 1776 vq*_i
FLAG -1120 1616 vd*
FLAG -1120 1648 vq*
FLAG 960 1744 0
FLAG -880 2000 om
FLAG 736 1600 pm_real
FLAG 608 1600 pe_real
FLAG 656 1680 oe_real
FLAG -2224 1728 om*
FLAG -1936 1728 tm*_p
FLAG -1904 1776 tm*_i
FLAG -2240 1856 0
FLAG -1824 1728 tm*
FLAG -448 1440 0
FLAG -176 1584 mu*_sh
FLAG -448 1632 0
FLAG -176 1648 mv*_sh
FLAG -448 1824 0
FLAG -176 1712 mw*_sh
FLAG 784 1360 iw_real
FLAG 928 1296 iu_real
FLAG 912 1600 om_real
FLAG -880 1952 pe
FLAG 688 1968 0
FLAG 784 1936 0
FLAG 688 1888 pe
FLAG 784 1856 oe
FLAG 864 1904 0
FLAG 864 1824 om
FLAG 592 2016 0
FLAG 592 1936 switch
FLAG -480 2016 0
FLAG 480 1296 id_real
FLAG 480 1328 iq_real
FLAG 640 1408 pe_real
SYMBOL voltage -2208 -848 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value PULSE(0 24)
SYMBOL diode -1904 -912 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL sw -1968 -880 M180
SYMATTR InstName S1
SYMBOL sw -1968 -592 M180
SYMATTR InstName S2
SYMBOL sw -1712 -880 M180
SYMATTR InstName S3
SYMBOL sw -1712 -592 M180
SYMATTR InstName S4
SYMBOL diode -1904 -608 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMBOL diode -1648 -912 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMBOL diode -1648 -608 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMBOL sw -1488 -880 M180
SYMATTR InstName S5
SYMBOL sw -1488 -592 M180
SYMATTR InstName S6
SYMBOL diode -1424 -912 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMBOL diode -1424 -608 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMBOL 3PhaseComplementaryPWM -128 1520 R0
WINDOW 123 8 265 Left 2
SYMATTR Value2 Tdelay=0 tripdt=0.1*Tdead
SYMATTR InstName U1
SYMATTR Value Vin1=-1 Vin2=1 Tperiod={Tperiod} Tdead={Tdead}
SYMBOL LTspiceControlLibrary\\Math\\Operands\\rcp -928 1792 R0
SYMATTR InstName U3
SYMBOL LTspiceControlLibrary\\Math\\Operands\\mul -784 1616 R0
SYMATTR InstName U18
SYMBOL LTspiceControlLibrary\\Math\\Operands\\mul -784 1680 R0
SYMATTR InstName U19
SYMBOL LTspiceControlLibrary\\Math\\Operands\\mul -784 1744 R0
SYMATTR InstName U20
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -864 1792 R0
SYMATTR Value K=2
SYMATTR InstName U31
SYMBOL voltage -944 -832 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value PULSE(0 20m 0.2 0.2)
SYMBOL FerriteBead -1360 -832 R270
WINDOW 0 16 0 VTop 2
SYMATTR InstName L1
SYMATTR Value 1n
SYMBOL FerriteBead -1360 -736 R270
WINDOW 0 16 0 VTop 2
SYMATTR InstName L2
SYMATTR Value 1n
SYMBOL LTspiceControlLibrary\\Motors\\PMSMotor -1120 -784 R0
SYMATTR InstName U5
SYMATTR Value Ra={Ra} Ld={Ld} Lq={Lq} Ke={Ke} Dm={Dm} Jm={Jm} Np={Np}
SYMBOL res -1984 -560 R0
SYMATTR InstName R21
SYMATTR Value {Rish}
SYMBOL res -1728 -560 R0
SYMATTR InstName R39
SYMATTR Value {Rish}
SYMBOL res -1504 -560 R0
SYMATTR InstName R57
SYMATTR Value {Rish}
SYMBOL voltage -2208 -272 R0
SYMATTR InstName V3
SYMATTR Value {Vcc}
SYMBOL res -2048 -208 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R24
SYMATTR Value {Ri1}
SYMBOL res -1952 -352 R0
SYMATTR InstName R22
SYMATTR Value {Ri2}
SYMBOL cap -1936 -208 R0
SYMATTR InstName C18
SYMATTR Value {Ci1}
SYMBOL res -1728 -160 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R42
SYMATTR Value {Ri1}
SYMBOL res -1632 -304 R0
SYMATTR InstName R40
SYMATTR Value {Ri2}
SYMBOL cap -1616 -160 R0
SYMATTR InstName C27
SYMATTR Value {Ci1}
SYMBOL res -1360 -208 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R59
SYMATTR Value {Ri1}
SYMBOL res -1264 -352 R0
SYMATTR InstName R58
SYMATTR Value {Ri2}
SYMBOL cap -1248 -208 R0
SYMATTR InstName C37
SYMATTR Value {Ci1}
SYMBOL res -1008 -160 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R63
SYMATTR Value {Rv1}
SYMBOL res -896 -176 R0
SYMATTR InstName R62
SYMATTR Value {Rv2}
SYMBOL cap -816 -160 R0
SYMATTR InstName C38
SYMATTR Value {Cv1}
SYMBOL SpecialFunctions\\sample -1632 416 R0
WINDOW 3 -64 -52 Left 2
SYMATTR Value Vhigh=adcmax Vlow=0
SYMATTR InstName A1
SYMBOL voltage -1792 1072 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V6
SYMATTR Value PULSE(0 1 {Tperiod/2} 1n 1n {Tperiod/2} {Tperiod})
SYMBOL SpecialFunctions\\sample -1632 608 R0
WINDOW 3 -64 -52 Left 2
SYMATTR Value Vhigh=adcmax Vlow=0
SYMATTR InstName A2
SYMBOL SpecialFunctions\\sample -1632 800 R0
WINDOW 3 -64 -52 Left 2
SYMATTR Value Vhigh=adcmax Vlow=0
SYMATTR InstName A3
SYMBOL SpecialFunctions\\sample -1632 992 R0
WINDOW 3 -64 -52 Left 2
SYMATTR Value Vhigh=adcmax Vlow=0
SYMATTR InstName A4
SYMBOL LTspiceControlLibrary\\Math\\Operands\\addk -1296 464 R0
SYMATTR Value k=biadc
SYMATTR InstName U22
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1408 464 R0
SYMATTR Value K=aiadc
SYMATTR InstName U36
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1952 416 R0
SYMATTR Value K=adcmax/Vcc
SYMATTR InstName U41
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1952 608 R0
SYMATTR Value K=adcmax/Vcc
SYMATTR InstName U49
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1952 800 R0
SYMATTR Value K=adcmax/Vcc
SYMATTR InstName U51
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1952 992 R0
SYMATTR Value K=adcmax/Vcc
SYMATTR InstName U53
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -2080 416 R0
SYMATTR Value K=pgagain
SYMATTR InstName U54
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -2080 608 R0
SYMATTR Value K=pgagain
SYMATTR InstName U55
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -2080 800 R0
SYMATTR Value K=pgagain
SYMATTR InstName U56
SYMBOL LTspiceControlLibrary\\Math\\Operands\\addk -1296 656 R0
SYMATTR Value k=biadc
SYMATTR InstName U57
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1408 656 R0
SYMATTR Value K=aiadc
SYMATTR InstName U58
SYMBOL LTspiceControlLibrary\\Math\\Operands\\addk -1296 848 R0
SYMATTR Value k=biadc
SYMATTR InstName U59
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1408 848 R0
SYMATTR Value K=aiadc
SYMATTR InstName U60
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1408 1040 R0
SYMATTR Value K=avadc
SYMATTR InstName U62
SYMBOL 3HallSensors -960 -960 R0
SYMATTR Value Np={Np}
SYMATTR InstName U27
SYMBOL Digital\\buf1 -720 464 R0
WINDOW 39 8 85 Left 2
SYMATTR SpiceLine Td={Tedge}
SYMATTR InstName A5
SYMBOL Digital\\buf1 -720 576 R0
WINDOW 39 8 85 Left 2
SYMATTR SpiceLine Td={Tedge}
SYMATTR InstName A7
SYMBOL Digital\\buf1 -720 688 R0
WINDOW 39 8 85 Left 2
SYMATTR SpiceLine Td={Tedge}
SYMATTR InstName A9
SYMBOL bv -368 624 R0
WINDOW 123 24 124 Left 2
SYMATTR InstName B1
SYMATTR Value V=idt(timerclk,0,V(clear))
SYMBOL bv -64 736 R0
SYMATTR InstName B2
SYMATTR Value V=if((!V(hwd)&!V(hvd)&V(hud)),1,if((!V(hwd)&V(hvd)&V(hud)),2,if((!V(hwd)&V(hvd)&!V(hud)),3,if((V(hwd)&V(hvd)&!V(hud)),4,if((V(hwd)&!V(hvd)&!V(hud)),5,if((V(hwd)&!V(hvd)&V(hud)),0,-1))))))
SYMBOL SpecialFunctions\\sample -96 416 R0
WINDOW 3 -64 -52 Left 2
SYMATTR Value Vhigh=timermax Vlow=0
SYMATTR InstName A12
SYMBOL Digital\\buf1 -208 608 M0
WINDOW 39 40 85 Right 2
SYMATTR SpiceLine Td={Tedge}
SYMATTR InstName A13
SYMBOL LTspiceControlLibrary\\Math\\Operands\\div 16 512 M180
SYMATTR InstName U28
SYMBOL LTspiceControlLibrary\\Math\\Operands\\add 224 576 R0
SYMATTR InstName U37
SYMBOL LTspiceControlLibrary\\Math\\Functions\\limit 96 576 R0
WINDOW 3 0 0 Left 2
SYMATTR Value y=0 z=1
SYMATTR InstName U42
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional 304 576 R0
SYMATTR Value K=2*pi/6
SYMATTR InstName U50
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional 304 464 R0
SYMATTR Value K=2*pi/6*timerclk
SYMATTR InstName U52
SYMBOL LTspiceControlLibrary\\Math\\Operands\\rcp 64 464 R0
SYMATTR InstName U61
SYMBOL LTspiceControlLibrary\\Math\\Operands\\xor -608 512 R0
SYMATTR InstName U64
SYMBOL LTspiceControlLibrary\\Math\\Operands\\xor -608 624 R0
SYMATTR InstName U65
SYMBOL LTspiceControlLibrary\\Math\\Operands\\xor -608 736 R0
SYMATTR InstName U66
SYMBOL LTspiceControlLibrary\\Math\\Operands\\or -528 512 R0
SYMATTR InstName U67
SYMBOL LTspiceControlLibrary\\Math\\Operands\\or -464 512 R0
SYMATTR InstName U68
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional 400 384 R0
SYMATTR Value K=1/Np
SYMATTR InstName U26
SYMBOL bv 960 1392 M0
SYMATTR InstName B8
SYMATTR Value V=I(L1)
SYMBOL bv 816 1392 M0
SYMATTR InstName B9
SYMATTR Value V=I(L2)
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\uw-abTransformation -960 1792 M0
SYMATTR InstName U43
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\xyRotation -1040 1792 M0
SYMATTR InstName U63
SYMBOL LTspiceControlLibrary\\Math\\Operands\\neg -1008 1984 M0
SYMATTR InstName U69
SYMBOL sub -1568 1552 R0
SYMATTR InstName U70
SYMBOL Integral -1360 1600 R0
SYMATTR Value T={Tiid}
SYMATTR InstName U71
SYMBOL Proportional -1488 1552 R0
SYMATTR Value K={Kpid}
SYMATTR InstName U72
SYMBOL add -1248 1552 R0
SYMATTR InstName U73
SYMBOL voltage -1632 1552 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V7
SYMATTR Value {0*sqrt(3)}
SYMBOL sub -1616 1760 R0
SYMATTR InstName U74
SYMBOL Integral -1360 1808 R0
SYMATTR Value T={Tiiq}
SYMATTR InstName U75
SYMBOL Proportional -1488 1760 R0
SYMATTR Value K={Kpiq}
SYMATTR InstName U76
SYMBOL add -1248 1760 R0
SYMATTR InstName U77
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\xyRotation -1104 1568 R0
SYMATTR InstName U78
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\ab-uvwTransformation -1024 1568 R0
SYMATTR InstName U79
SYMBOL bv 960 1648 M0
SYMATTR InstName B10
SYMATTR Value V=I(V4)
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Integral 800 1632 M0
SYMATTR InstName U80
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional 704 1632 M0
SYMATTR Value K={Np}
SYMATTR InstName U81
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional 704 1712 M0
SYMATTR Value K={Np}
SYMATTR InstName U82
SYMBOL sub -2192 1760 R0
SYMATTR InstName U84
SYMBOL Integral -1968 1808 R0
SYMATTR InstName U85
SYMATTR Value T={Tiom}
SYMBOL Proportional -2112 1760 R0
SYMATTR Value K={Kpom}
SYMATTR InstName U86
SYMBOL add -1888 1760 R0
SYMATTR InstName U87
SYMBOL voltage -2240 1760 R0
WINDOW 3 24 44 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value PULSE(0 100)
SYMATTR InstName V9
SYMBOL Proportional -1792 1760 R0
SYMATTR Value K={1/(Ke*Np)}
SYMATTR InstName U88
SYMBOL SpecialFunctions\\sample -352 1440 R0
SYMATTR InstName A6
SYMBOL SpecialFunctions\\sample -352 1632 R0
SYMATTR InstName A8
SYMBOL SpecialFunctions\\sample -352 1824 R0
SYMATTR InstName A10
SYMBOL bv 688 1872 R0
SYMATTR InstName B3
SYMATTR Value V=if(V(switch),V(pe_real),V(pe_hs))
SYMBOL bv 784 1840 R0
SYMATTR InstName B4
SYMATTR Value V=if(V(switch),V(oe_real),V(oe_hs))
SYMBOL bv 864 1808 R0
SYMATTR InstName B5
SYMATTR Value V=if(V(switch),V(om_real),V(om_hs))
SYMBOL bv 592 1920 R0
SYMATTR InstName B6
SYMATTR Value V=time<10ms
SYMBOL voltage -480 1920 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value PULSE(0 1 {Tperiod/2} 1n 1n {Tperiod/2} {Tperiod})
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\uw-abTransformation 640 1248 M0
SYMATTR InstName U2
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\xyRotation 560 1248 M0
SYMATTR InstName U4
SYMBOL LTspiceControlLibrary\\Math\\Operands\\neg 592 1440 M0
SYMATTR InstName U6
SYMBOL LTspiceControlLibrary\\Math\\Functions\\int -1872 416 R0
SYMATTR InstName U7
SYMBOL LTspiceControlLibrary\\Math\\Functions\\int -1872 608 R0
SYMATTR InstName U8
SYMBOL LTspiceControlLibrary\\Math\\Functions\\int -1872 800 R0
SYMATTR InstName U9
SYMBOL LTspiceControlLibrary\\Math\\Functions\\int -1872 992 R0
SYMATTR InstName U10
SYMBOL LTspiceControlLibrary\\Math\\Functions\\limit -704 1616 R0
WINDOW 3 0 0 Left 2
SYMATTR Value y=-1.01 z=0.93
SYMATTR InstName U11
SYMBOL LTspiceControlLibrary\\Math\\Functions\\limit -704 1680 R0
WINDOW 3 0 0 Left 2
SYMATTR Value y=-1.01 z=0.93
SYMATTR InstName U12
SYMBOL LTspiceControlLibrary\\Math\\Functions\\limit -704 1744 R0
WINDOW 3 0 0 Left 2
SYMATTR Value y=-1.01 z=0.93
SYMATTR InstName U13
SYMBOL LTspiceControlLibrary\\Math\\Functions\\int -336 624 R270
SYMATTR InstName U14
TEXT -2216 -1184 Left 2 !.tran 0.5
TEXT -1960 -1080 Left 2 !.model SW SW(Ron=.1 Roff=10k Vt=0.5)\n.model D D(Ron=.1 Roff=10k Vfwd=.4)
TEXT -72 1536 Left 2 ;PWM
TEXT -2256 -1224 Left 4 ;Config
TEXT -2296 -1280 Left 5 ;PMSM Vector Control with INV-1TGKIT-A (3 Shunt and Hall Sensor)
TEXT -2256 -1088 Left 4 ;Circuit
TEXT -2288 152 Left 4 ;Controller
TEXT -1240 -632 Left 2 !** Anaheim Automation bly171s-15v-8000 parameters\n.params Ra=0.35/2 Ld=0.35m/2 Lq=0.35m/2\n.params Ke=1.57m*60/(2*pi)/sqrt(2)/Np Dm=Jm/0.3 Jm=340u*7.062m Np=8/2
TEXT -2184 288 Left 2 !.params adcbit=12 adcmax=2**adcbit-1\n.params pgagain=5
TEXT -2224 208 Left 2 ;analog-digital converter
TEXT -1968 0 Left 2 !.params Vcc=5\n.params Rish=50m Ri1=220 Ri2=2k Ci1=1000p\n.params Rv1=10k Rv2=1k Cv1=0.1u\n.params Vib=Vcc*(Rish+Ri1)/(Rish+Ri1+Ri2)
TEXT -1704 248 Left 2 !.params aiadc=-Vcc/(adcmax*pgagain)*(Rish+Ri1+Ri2)/(Rish*Ri2)\n.params biadc=Vcc*(Rish+Ri1)/(Rish*Ri2)\n.params avadc=Vcc/adcmax*(Rv1+Rv2)/Rv2
TEXT -768 440 Left 2 !.params Tedge=1n
TEXT -160 248 Left 2 !.params timerbit=16 timermax=2**timerbit-1\n.params timerclk=96Meg/256
TEXT -720 1832 Left 2 ;sensor
TEXT -1640 1480 Left 2 ;current controller
TEXT -1168 1480 Left 2 ;coordinate transformation
TEXT -144 1832 Left 2 !** PWM parameters\n.params Tperiod=100u Tdead=3u
TEXT -1496 1256 Left 2 !** current control parameters\n.params Oci=0.5/Tperiod\n.params wi=0.2\n.params Kpid=Ld*Oci\n.params Tiid=1/(wi*(1-wi)*Oci)\n.params Kpiq=Lq*Oci\n.params Tiiq=1/(wi*(1-wi)*Oci)
TEXT -2136 1472 Left 2 !** speed control parameters\n.params Ocom=0.1*Oci\n.params wom=0.1\n.params Kpom=Jm*Ocom\n.params Tiom=1/(wom*(1-wom)*Ocom)
TEXT -2248 1672 Left 2 ;speed controller
TEXT -784 200 Left 2 ;speed and angle calcurator for hall sensor
