Version 4
SHEET 1 1304 1156
WIRE -2016 -1008 -2208 -1008
WIRE -1760 -1008 -2016 -1008
WIRE -2208 -800 -2208 -1008
WIRE -1664 -800 -1968 -800
WIRE -1504 -800 -1664 -800
WIRE -1328 -800 -1376 -800
WIRE -1280 -800 -1328 -800
WIRE -1152 -800 -1200 -800
WIRE -1008 -800 -1072 -800
WIRE -1008 -784 -1008 -800
WIRE -1968 -704 -1968 -800
WIRE -1664 -704 -1712 -704
WIRE -1504 -704 -1664 -704
WIRE -1360 -704 -1376 -704
WIRE -1008 -704 -1360 -704
WIRE -1360 -640 -1360 -704
WIRE -2016 -624 -2016 -1008
WIRE -1760 -624 -1760 -1008
WIRE -2016 -528 -2016 -544
WIRE -1968 -528 -1968 -544
WIRE -1968 -528 -2016 -528
WIRE -1760 -528 -1760 -544
WIRE -1712 -528 -1712 -544
WIRE -1712 -528 -1760 -528
WIRE -2208 -496 -2208 -720
WIRE -2016 -496 -2016 -528
WIRE -2016 -496 -2208 -496
WIRE -1760 -496 -1760 -528
WIRE -1760 -496 -2016 -496
WIRE -2208 -464 -2208 -496
WIRE -2176 -288 -2208 -288
WIRE -2032 -288 -2176 -288
WIRE -1952 -288 -1968 -288
WIRE -1936 -288 -1952 -288
WIRE -1840 -288 -1872 -288
WIRE -1808 -288 -1840 -288
WIRE -1712 -288 -1728 -288
WIRE -1696 -288 -1712 -288
WIRE -1616 -288 -1632 -288
WIRE -1520 -288 -1552 -288
WIRE -1376 -288 -1520 -288
WIRE -1344 -288 -1376 -288
WIRE -1264 -288 -1280 -288
WIRE -1248 -288 -1264 -288
WIRE -1152 -288 -1168 -288
WIRE -1136 -288 -1152 -288
WIRE -1120 -288 -1136 -288
WIRE -1024 -288 -1056 -288
WIRE -1008 -288 -1024 -288
WIRE -912 -288 -944 -288
WIRE -880 -288 -912 -288
WIRE -800 -288 -816 -288
WIRE -784 -288 -800 -288
WIRE -704 -288 -720 -288
WIRE -688 -288 -704 -288
WIRE -608 -288 -688 -288
WIRE -1264 -256 -1264 -288
WIRE -2208 -240 -2208 -288
WIRE -1520 -240 -1520 -288
WIRE -1376 -240 -1392 -240
WIRE -1312 -240 -1312 -256
WIRE -1312 -240 -1376 -240
WIRE -1152 -224 -1152 -288
WIRE -1152 -224 -1232 -224
WIRE -688 -192 -688 -288
WIRE -672 -192 -688 -192
WIRE -1488 -176 -1488 -208
WIRE -1264 -176 -1264 -192
WIRE -1264 -176 -1488 -176
WIRE -2112 -112 -2128 -112
WIRE -2032 -112 -2048 -112
WIRE -2000 -112 -2000 -256
WIRE -2000 -112 -2032 -112
WIRE -1008 -112 -1024 -112
WIRE -912 -112 -944 -112
WIRE -848 -112 -848 -256
WIRE -848 -112 -912 -112
WIRE -2176 -64 -2208 -64
WIRE -2128 -64 -2128 -112
WIRE -2128 -64 -2176 -64
WIRE -1664 -64 -1664 -256
WIRE -1664 -64 -2128 -64
WIRE -1024 -64 -1024 -112
WIRE -1024 -64 -1664 -64
WIRE -1952 -16 -1952 -288
WIRE -1888 -16 -1952 -16
WIRE -1568 -16 -1888 -16
WIRE -2208 16 -2208 -64
WIRE -1760 16 -1760 -256
WIRE -1696 16 -1760 16
WIRE -1632 16 -1696 16
WIRE -1568 16 -1568 -16
WIRE -1776 48 -1776 -256
WIRE -1696 48 -1776 48
WIRE -1632 48 -1696 48
WIRE -1200 48 -1200 -256
WIRE -1200 48 -1568 48
WIRE -1136 48 -1200 48
WIRE -1088 48 -1136 48
WIRE -752 48 -752 -256
WIRE -752 48 -1024 48
WIRE -1216 80 -1216 -256
WIRE -1216 80 -1568 80
WIRE -1136 80 -1216 80
WIRE -1088 80 -1136 80
WIRE -848 80 -848 -112
WIRE -848 80 -1024 80
WIRE -752 96 -752 48
WIRE -752 96 -768 96
FLAG -2208 -464 0
FLAG -1664 -704 V
FLAG -2208 -1008 DC_P
FLAG -768 96 DC_P
FLAG -800 -288 v*
FLAG -1360 -640 0
FLAG -2208 96 0
FLAG -1712 -288 om*
FLAG -1376 -288 tm*_p
FLAG -1376 -240 tm*_i
FLAG -2176 -64 om
FLAG -2208 -160 0
FLAG -1136 -288 tm*
FLAG -1328 -800 TM
FLAG -1664 -800 U
FLAG -704 -288 m*
FLAG -2032 -112 pm
FLAG -2176 -288 pm*
FLAG -1840 -288 om*_p
FLAG -912 -112 emf^
FLAG -1024 -288 i*
FLAG -912 -288 v*_re
FLAG -1136 48 tm_lower
FLAG -1136 80 tm_upper
FLAG -1696 16 om_lower
FLAG -1696 48 om_upper
FLAG -1888 -16 pm_error
FLAG -2064 -560 0
FLAG -1808 -560 0
FLAG -496 -288 mu*
FLAG -496 -192 mv*
FLAG -2064 -608 mu*
FLAG -1808 -608 mv*
SYMBOL voltage -2208 -816 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value 5
SYMBOL add -864 -256 R0
SYMATTR InstName U15
SYMBOL bv -2208 0 R0
SYMATTR InstName B3
SYMATTR Value V=I(V4)
SYMBOL voltage -1008 -800 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value SINE(0 1m 10)
SYMBOL sub -1680 -256 R0
SYMATTR InstName U29
SYMBOL Proportional -1600 -256 R0
SYMATTR Value K={Kpom}
SYMATTR InstName U33
SYMBOL add -1328 -256 R0
SYMATTR InstName U34
SYMBOL voltage -2208 -256 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V5
SYMATTR Value PULSE({0*pi} {100*pi} 0 1n 1n 3 6)
SYMBOL Proportional -992 -256 R0
SYMATTR Value K={Ra1}
SYMATTR InstName U35
SYMBOL LTspiceControlLibrary\\Motors\\DCMotor -1376 -752 R0
SYMATTR InstName U5
SYMATTR Value Ra={Ra} La={La} Ke={Ke} Dm={Dm} Jm={Jm}
SYMBOL Proportional -992 -80 R0
SYMATTR Value K={Ke1}
SYMATTR InstName U4
SYMBOL LTspiceControlLibrary\\Math\\Operands\\div -768 -256 R0
SYMATTR InstName U3
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Integral -1440 -208 R0
SYMATTR Value T={Tiom}
SYMATTR InstName U6
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -1232 -240 M90
SYMATTR InstName U13
SYMBOL sub -1504 -208 R0
SYMATTR InstName U14
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Integral -2096 -80 R0
SYMATTR InstName U16
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -2016 -256 R0
SYMATTR InstName U17
SYMBOL Proportional -1920 -256 R0
SYMATTR Value K={Kppm}
SYMATTR InstName U19
SYMBOL Proportional -1104 -256 R0
SYMATTR Value K={1/Ke1}
SYMATTR InstName U20
SYMBOL ind -1168 -784 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value {Jm_load}
SYMATTR SpiceLine Rser=0
SYMBOL res -1184 -816 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value {Dm_load}
SYMBOL LTspiceControlLibrary\\Math\\Functions\\mid -1792 -256 R0
SYMATTR InstName U12
SYMBOL LTspiceControlLibrary\\Math\\Functions\\mid -1232 -256 R0
SYMATTR InstName U18
SYMBOL LTspiceControlLibrary\\Skeletons\\2in-2out -1040 112 M0
WINDOW 38 30 0 Right 2
SYMATTR SpiceModel TmLimitCalc
SYMATTR InstName U24
SYMBOL LTspiceControlLibrary\\Skeletons\\3in-2out -1584 112 M0
WINDOW 38 31 0 Right 2
SYMATTR SpiceModel OmLimitCalc
SYMATTR InstName U25
SYMBOL LTspiceControlLibrary\\Sources\\DCTransformer -2016 -640 R0
SYMATTR InstName U1
SYMBOL LTspiceControlLibrary\\Sources\\DCTransformer -1760 -640 R0
SYMATTR InstName U2
SYMBOL LTspiceControlLibrary\\Math\\Functions\\limit -592 -256 R0
SYMATTR Value y=0 z=1
SYMATTR InstName U7
SYMBOL LTspiceControlLibrary\\Math\\Operands\\neg -656 -160 R0
SYMATTR InstName U8
SYMBOL LTspiceControlLibrary\\Math\\Functions\\limit -592 -160 R0
SYMATTR Value y=0 z=1
SYMATTR InstName U9
SYMBOL res -1728 -720 R0
SYMATTR InstName Rsw2
SYMATTR Value {Ron}
SYMBOL res -1984 -720 R0
SYMATTR InstName Rsw1
SYMATTR Value {Ron}
TEXT -2216 -1184 Left 2 !.tran 10 startup
TEXT -2216 -1152 Left 2 !.model SW SW(Ron={Ron} Roff=1Meg Vt=0.5)\n.model D D(Ron=.1 Roff=1Meg Vfwd=.7)
TEXT -2256 -1224 Left 4 ;Config
TEXT -2296 -1280 Left 5 ;DC Motor Position Control
TEXT -2256 -1088 Left 4 ;Circuit
TEXT -2248 -392 Left 4 ;Controller
TEXT -1440 -1096 Left 2 ;Analogy between\nElectric Circuit  - Rotating Machinery\nQ: charge - Pm: angle\nI: current - Om: angular velocity\nV: voltage - Tm: torque\nR: resistance - Dm: viscous resistance\nL: inductance - Jm: moment of inertia\nC: capacitance - Km: torsion coefficient
TEXT -2024 -344 Left 2 ;position controller
TEXT -1048 -816 Left 2 ;disturbance torque
TEXT -1616 -344 Left 2 ;speed controller
TEXT -1440 -152 Left 2 ;antiwindup
TEXT -1096 -160 Left 2 ;EMF compensation
TEXT -768 -1216 Left 2 !** DCMotor parameteras\n.param Ra=1 La=1m Ke=0.01 Dm=10u Jm=10u
TEXT -768 -1144 Left 2 !** load parameters\n.param Dm_load=20u Jm_load=50u
TEXT -768 -808 Left 2 !** speed control parameters\n.param Ocom=500\n.param wom=0.2\n.param Kpom=Jm1*Ocom\n.param Tiom=1/(wom*(1-wom)*Ocom)\n.param Tmlimit=30m
TEXT -768 -1064 Left 2 !** switch parameters\n.param Ron=0.1
TEXT -1064 152 Left 2 !.subckt TmLimitCalc\n+ vdc emf ; 2 in\n+ tm_lower tm_upper ; 2 out\n; voltage-adjusted torque limit\nB1 tm_lower 0 V=max(-Tmlimit,(Ke1/Ra1)*(-V(vdc)-V(emf))) tripdt=1e300\nB2 tm_upper 0 V=min(Tmlimit,(Ke1/Ra1)*(V(vdc)-V(emf))) tripdt=1e300\n.ends
TEXT -2088 64 Left 2 !.subckt OmLimitCalc\n+ pm_error tm_lower tm_upper ; 3 in\n+ om_lower om_upper ; 2 out\nB1 tm_brake 0 V=max(0,if(V(pm_error)>0,-V(tm_lower),V(tm_upper))) tripdt=1e300\nB2 om_brake 0 V=( ; braking-adjusted speed limit\n+ sgn(V(pm_error)) * sqrt(\n+   (Kbrake * 2 / Jm1) * V(tm_brake) * abs(V(pm_error))\n+ ) ) tripdt=1e300\nB3 om_lower 0 V=if(V(om_brake)>=0,-Omlimit,max(-Omlimit,V(om_brake))) tripdt=1e300\nB4 om_upper 0 V=if(V(om_brake)<=0,Omlimit,min(Omlimit,V(om_brake))) tripdt=1e300\n.ends
TEXT -1040 -344 Left 2 ;output voltage calculator
TEXT -1184 -32 Left 2 ;torque limit calculator
TEXT -1736 -32 Left 2 ;speed limit calculator
TEXT -768 -992 Left 2 !** estimated controlled system parameters\n.param Ra1=0.9*(Ra+2*Ron) La1=0.9*La Ke1=0.9*Ke\n.param Dm1=0.9*(Dm+Dm_load) Jm1=0.9*(Jm+Jm_load)
TEXT -768 -624 Left 2 !** position control parameters\n.param Ocpm=0.1*Ocom\n.param Kppm=1*Ocpm\n.param Omlimit=300\n.param Kbrake=0.8
TEXT -1800 -320 Left 2 ;limitter
TEXT -1240 -320 Left 2 ;limitter
TEXT -768 -888 Left 2 !** PWM parameters\n.param Tpwm={1/1k} Tdead=1u
TEXT -1200 -848 Left 2 ;load
TEXT -1512 -600 Left 2 ;NOTE\nSwitching elements are approximated\nby imaginary variable dc transformers.\nThis reduces transient analysis time and\nallows ac analysis.\nDiscontinuous conduction mode and\nnonconduction mode are NOT considered.
