Version 4
SHEET 1 880 680
WIRE -2160 -2880 -2400 -2880
WIRE -1904 -2880 -2160 -2880
WIRE -1680 -2880 -1904 -2880
WIRE -2160 -2848 -2160 -2880
WIRE -2080 -2848 -2160 -2848
WIRE -1904 -2848 -1904 -2880
WIRE -1824 -2848 -1904 -2848
WIRE -1680 -2848 -1680 -2880
WIRE -1600 -2848 -1680 -2848
WIRE -2160 -2832 -2160 -2848
WIRE -2080 -2832 -2080 -2848
WIRE -1904 -2832 -1904 -2848
WIRE -1824 -2832 -1824 -2848
WIRE -1680 -2832 -1680 -2848
WIRE -1600 -2832 -1600 -2848
WIRE -2160 -2736 -2160 -2752
WIRE -2080 -2736 -2080 -2768
WIRE -2080 -2736 -2160 -2736
WIRE -1904 -2736 -1904 -2752
WIRE -1824 -2736 -1824 -2768
WIRE -1824 -2736 -1904 -2736
WIRE -1680 -2736 -1680 -2752
WIRE -1600 -2736 -1600 -2768
WIRE -1600 -2736 -1680 -2736
WIRE -2160 -2672 -2160 -2736
WIRE -1648 -2672 -2160 -2672
WIRE -1488 -2672 -1648 -2672
WIRE -2400 -2624 -2400 -2880
WIRE -1488 -2624 -1488 -2672
WIRE -1456 -2624 -1488 -2624
WIRE -1312 -2624 -1328 -2624
WIRE -1200 -2624 -1216 -2624
WIRE -1184 -2624 -1200 -2624
WIRE -1184 -2608 -1184 -2624
WIRE -1904 -2576 -1904 -2736
WIRE -1648 -2576 -1904 -2576
WIRE -1456 -2576 -1648 -2576
WIRE -1456 -2528 -1488 -2528
WIRE -1312 -2528 -1328 -2528
WIRE -1184 -2528 -1312 -2528
WIRE -1680 -2480 -1680 -2736
WIRE -1648 -2480 -1680 -2480
WIRE -1488 -2480 -1488 -2528
WIRE -1488 -2480 -1648 -2480
WIRE -1312 -2464 -1312 -2528
WIRE -2160 -2432 -2160 -2672
WIRE -2080 -2432 -2160 -2432
WIRE -1904 -2432 -1904 -2576
WIRE -1824 -2432 -1904 -2432
WIRE -1680 -2432 -1680 -2480
WIRE -1600 -2432 -1680 -2432
WIRE -2160 -2416 -2160 -2432
WIRE -1904 -2416 -1904 -2432
WIRE -1680 -2416 -1680 -2432
WIRE -2080 -2400 -2080 -2432
WIRE -1824 -2400 -1824 -2432
WIRE -1600 -2400 -1600 -2432
WIRE -2160 -2320 -2160 -2336
WIRE -2080 -2320 -2080 -2336
WIRE -2080 -2320 -2160 -2320
WIRE -1904 -2320 -1904 -2336
WIRE -1824 -2320 -1824 -2336
WIRE -1824 -2320 -1904 -2320
WIRE -1680 -2320 -1680 -2336
WIRE -1600 -2320 -1600 -2336
WIRE -1600 -2320 -1680 -2320
WIRE -2400 -2288 -2400 -2544
WIRE -2160 -2288 -2160 -2320
WIRE -2160 -2288 -2400 -2288
WIRE -1904 -2288 -1904 -2320
WIRE -1904 -2288 -2160 -2288
WIRE -1680 -2288 -1680 -2320
WIRE -1680 -2288 -1904 -2288
WIRE -2400 -2256 -2400 -2288
WIRE -2048 -2048 -2064 -2048
WIRE -1936 -2048 -1984 -2048
WIRE -1840 -2048 -1872 -2048
WIRE -1408 -2048 -1424 -2048
WIRE -1840 -2016 -1856 -2016
WIRE -1632 -2000 -1664 -2000
WIRE -2208 -1984 -2304 -1984
WIRE -2064 -1984 -2064 -2048
WIRE -2064 -1984 -2080 -1984
WIRE -1840 -1984 -2064 -1984
WIRE -1424 -1984 -1424 -2048
WIRE -1424 -1984 -1440 -1984
WIRE -1344 -1984 -1424 -1984
WIRE -1632 -1968 -1648 -1968
WIRE -1024 -1952 -1120 -1952
WIRE -2176 -1920 -2176 -1952
WIRE -2176 -1920 -2304 -1920
WIRE -1648 -1920 -1648 -1968
WIRE -1152 -1920 -1184 -1920
WIRE -1088 -1888 -1120 -1888
WIRE -1024 -1888 -1040 -1888
WIRE -2112 -1856 -2112 -1952
WIRE -2112 -1856 -2304 -1856
WIRE -1152 -1856 -1184 -1856
WIRE -1056 -1856 -1104 -1856
WIRE -1024 -1824 -1120 -1824
WIRE -2064 -1808 -2064 -1984
WIRE -2048 -1808 -2064 -1808
WIRE -1152 -1792 -1184 -1792
WIRE -1776 -1776 -1824 -1776
WIRE -1632 -1776 -1680 -1776
WIRE -1600 -1776 -1600 -1936
WIRE -1600 -1776 -1632 -1776
WIRE -1088 -1760 -1120 -1760
WIRE -1024 -1760 -1040 -1760
WIRE -1776 -1728 -1792 -1728
WIRE -1152 -1728 -1184 -1728
WIRE -1104 -1728 -1104 -1856
WIRE -1056 -1728 -1104 -1728
WIRE -1024 -1696 -1120 -1696
WIRE -1152 -1664 -1184 -1664
WIRE -1088 -1632 -1120 -1632
WIRE -1024 -1632 -1040 -1632
WIRE -1152 -1600 -1184 -1600
WIRE -1104 -1600 -1104 -1728
WIRE -1056 -1600 -1104 -1600
WIRE -2304 -1568 -2336 -1568
WIRE -2272 -1568 -2304 -1568
WIRE -2192 -1568 -2208 -1568
WIRE -2096 -1568 -2128 -1568
WIRE -1952 -1568 -2096 -1568
WIRE -1920 -1568 -1952 -1568
WIRE -1840 -1568 -1856 -1568
WIRE -1824 -1568 -1840 -1568
WIRE -1696 -1568 -1712 -1568
WIRE -1648 -1568 -1696 -1568
WIRE -1600 -1568 -1648 -1568
WIRE -1504 -1568 -1536 -1568
WIRE -1104 -1568 -1104 -1600
WIRE -1104 -1568 -1504 -1568
WIRE -2240 -1536 -2256 -1536
WIRE -1840 -1536 -1840 -1568
WIRE -2096 -1520 -2096 -1568
WIRE -1952 -1520 -1968 -1520
WIRE -1888 -1520 -1888 -1536
WIRE -1888 -1520 -1952 -1520
WIRE -2336 -1504 -2336 -1568
WIRE -1696 -1504 -1696 -1568
WIRE -1696 -1504 -1808 -1504
WIRE -1568 -1504 -1568 -1536
WIRE -2064 -1456 -2064 -1488
WIRE -1840 -1456 -1840 -1472
WIRE -1840 -1456 -2064 -1456
WIRE -1984 -1296 -2080 -1296
WIRE -1856 -1296 -1920 -1296
WIRE -1952 -1264 -2000 -1264
WIRE -1856 -1264 -1872 -1264
WIRE -1648 -1248 -1680 -1248
WIRE -1600 -1248 -1648 -1248
WIRE -1424 -1248 -1472 -1248
WIRE -1296 -1248 -1344 -1248
WIRE -1856 -1232 -1904 -1232
WIRE -1344 -1232 -1344 -1248
WIRE -1344 -1232 -1360 -1232
WIRE -1568 -1216 -1616 -1216
WIRE -1392 -1184 -1456 -1184
WIRE -1264 -1184 -1328 -1184
WIRE -1984 -1104 -2080 -1104
WIRE -1856 -1104 -1920 -1104
WIRE -2000 -1072 -2000 -1264
WIRE -1952 -1072 -2000 -1072
WIRE -1856 -1072 -1872 -1072
WIRE -1648 -1056 -1680 -1056
WIRE -1600 -1056 -1648 -1056
WIRE -1424 -1056 -1472 -1056
WIRE -1296 -1056 -1344 -1056
WIRE -1904 -1040 -1904 -1232
WIRE -1856 -1040 -1904 -1040
WIRE -1344 -1040 -1344 -1056
WIRE -1344 -1040 -1360 -1040
WIRE -1616 -1024 -1616 -1216
WIRE -1568 -1024 -1616 -1024
WIRE -1456 -992 -1456 -1184
WIRE -1392 -992 -1456 -992
WIRE -1328 -992 -1328 -1184
WIRE -1264 -992 -1328 -992
WIRE -1984 -912 -2080 -912
WIRE -1856 -912 -1920 -912
WIRE -2000 -880 -2000 -1072
WIRE -1952 -880 -2000 -880
WIRE -1856 -880 -1872 -880
WIRE -2000 -864 -2000 -880
WIRE -2000 -864 -2016 -864
WIRE -1648 -864 -1680 -864
WIRE -1600 -864 -1648 -864
WIRE -1424 -864 -1472 -864
WIRE -1296 -864 -1344 -864
WIRE -1904 -848 -1904 -1040
WIRE -1856 -848 -1904 -848
WIRE -1344 -848 -1344 -864
WIRE -1344 -848 -1360 -848
WIRE -1616 -832 -1616 -1024
WIRE -1568 -832 -1616 -832
WIRE -1984 -800 -2304 -800
WIRE -1904 -800 -1904 -848
WIRE -1904 -800 -1920 -800
WIRE -1456 -800 -1456 -992
WIRE -1456 -800 -1472 -800
WIRE -1392 -800 -1456 -800
WIRE -1328 -800 -1328 -992
WIRE -1264 -800 -1328 -800
WIRE -2304 -784 -2304 -800
WIRE -1328 -784 -1328 -800
WIRE -1616 -736 -1616 -832
WIRE -1616 -736 -1632 -736
WIRE -1440 -720 -1456 -720
WIRE -1456 -704 -1456 -720
WIRE -2144 -640 -2208 -640
WIRE -1952 -640 -1952 -768
WIRE -2112 -576 -2112 -608
WIRE -2112 -576 -2208 -576
WIRE -2048 -512 -2048 -608
WIRE -2048 -512 -2208 -512
FLAG -2400 -2256 0
FLAG -2208 -2816 UP
FLAG -2208 -2768 0
FLAG -1648 -2672 U
FLAG -2208 -2400 UN
FLAG -2208 -2352 0
FLAG -1952 -2816 VP
FLAG -1952 -2768 0
FLAG -1952 -2400 VN
FLAG -1952 -2352 0
FLAG -1648 -2576 V
FLAG -2400 -2880 DC_P
FLAG -1728 -2816 WP
FLAG -1728 -2768 0
FLAG -1728 -2400 WN
FLAG -1728 -2352 0
FLAG -1648 -2480 W
FLAG -1312 -2464 0
FLAG -1200 -2624 tm
FLAG -1296 -2576 hu
FLAG -1264 -2576 hv
FLAG -1232 -2576 hw
FLAG -1376 -1792 hu^
FLAG -1376 -1744 hv^
FLAG -1376 -1696 hw^
FLAG -1312 -1792 nhu^
FLAG -1312 -1744 nhv^
FLAG -1312 -1696 nhw^
FLAG -1184 -1888 hu^
FLAG -1184 -1856 nhv^
FLAG -1184 -1952 nhu^
FLAG -1184 -1920 hv^
FLAG -1184 -1760 hv^
FLAG -1184 -1728 nhw^
FLAG -1184 -1824 nhv^
FLAG -1184 -1792 hw^
FLAG -1184 -1632 hw^
FLAG -1184 -1600 nhu^
FLAG -1184 -1696 nhw^
FLAG -1184 -1664 hu^
FLAG -1024 -1952 UP
FLAG -1024 -1888 UN
FLAG -1024 -1824 VP
FLAG -1024 -1760 VN
FLAG -1024 -1696 WP
FLAG -1024 -1632 WN
FLAG -1568 -1424 0
FLAG -1504 -1568 pwm
FLAG -2368 -1984 hu0^
FLAG -2368 -1920 hv0^
FLAG -2368 -1856 hw0^
FLAG -1856 -2016 0
FLAG -1344 -1984 oe_hs^
FLAG -1344 -2048 om_hs^
FLAG -1792 -1728 0
FLAG -1648 -1840 0
FLAG -2336 -1424 0
FLAG -2304 -1568 om*
FLAG -1952 -1568 m*_p
FLAG -1952 -1520 m*_i
FLAG -1648 -1568 m*
FLAG -2256 -1536 om_hs^
FLAG -2080 -1296 U
FLAG -2080 -864 DC_P
FLAG -1872 -1264 0
FLAG -2080 -1104 V
FLAG -1872 -1072 0
FLAG -2080 -912 W
FLAG -1872 -880 0
FLAG -2272 -640 hu^
FLAG -2272 -576 hv^
FLAG -2272 -512 hw^
FLAG -1760 -736 oe_hs^
FLAG -1648 -1248 hu0^
FLAG -1648 -1056 hv0^
FLAG -1648 -864 hw0^
FLAG -1296 -1216 0
FLAG -1296 -1024 0
FLAG -1424 -1024 0
FLAG -1328 -704 0
FLAG -1232 -1232 hu^
FLAG -1232 -1040 hv^
FLAG -1232 -848 hw^
FLAG -1456 -624 0
FLAG -1456 -720 1v
FLAG -1296 -832 1v
FLAG -1424 -832 1v
FLAG -1424 -1216 1v
FLAG -2304 -704 0
FLAG -1632 -1776 startup
FLAG -1472 -800 startup
SYMBOL voltage -2400 -2640 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value 100
SYMBOL diode -2096 -2768 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL sw -2160 -2736 M180
SYMATTR InstName S1
SYMBOL sw -2160 -2320 M180
SYMATTR InstName S2
SYMBOL sw -1904 -2736 M180
SYMATTR InstName S3
SYMBOL sw -1904 -2320 M180
SYMATTR InstName S4
SYMBOL diode -2096 -2336 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMBOL diode -1840 -2768 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMBOL diode -1840 -2336 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMBOL sw -1680 -2736 M180
SYMATTR InstName S5
SYMBOL sw -1680 -2320 M180
SYMATTR InstName S6
SYMBOL diode -1616 -2768 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMBOL diode -1616 -2336 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMBOL voltage -1184 -2624 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value PULSE(0 3 20m 100m)
SYMBOL LTspiceControlLibrary\\Motors\\PMSMotor -1328 -2576 R0
SYMATTR InstName U1
SYMATTR Value Ra=0.1 Ld=1m Lq=1m Ke=0.1 Dm=0.1m Jm=0.1m Np={Np}
SYMBOL LTspiceControlLibrary\\Sensors\\3HallSensors -1184 -2752 R0
WINDOW 123 -128 53 Left 2
SYMATTR Value2 Pm0={-Pdelay/Np}
SYMATTR Value Np={Np}
SYMATTR InstName U2
SYMBOL LTspiceControlLibrary\\Math\\Operands\\inv -1360 -1760 R0
SYMATTR InstName U3
SYMBOL LTspiceControlLibrary\\Math\\Operands\\inv -1360 -1712 R0
SYMATTR InstName U4
SYMBOL LTspiceControlLibrary\\Math\\Operands\\inv -1360 -1664 R0
SYMATTR InstName U5
SYMBOL LTspiceControlLibrary\\Math\\Operands\\and -1168 -1856 R0
SYMATTR InstName U6
SYMBOL LTspiceControlLibrary\\Math\\Operands\\and -1168 -1920 R0
SYMATTR InstName U7
SYMBOL LTspiceControlLibrary\\Math\\Operands\\and -1168 -1728 R0
SYMATTR InstName U8
SYMBOL LTspiceControlLibrary\\Math\\Operands\\and -1168 -1792 R0
SYMATTR InstName U9
SYMBOL LTspiceControlLibrary\\Math\\Operands\\and -1168 -1600 R0
SYMATTR InstName U10
SYMBOL LTspiceControlLibrary\\Math\\Operands\\and -1168 -1664 R0
SYMATTR InstName U11
SYMBOL nle -1584 -1536 R0
SYMATTR InstName U12
SYMBOL TriangleWaveVoltage -1568 -1520 R0
SYMATTR InstName U13
SYMATTR Value V1=0 V2=1 Tperiod={Tcarrier} tratio=1
SYMBOL LTspiceControlLibrary\\Math\\Operands\\and -1072 -1856 R0
SYMATTR InstName U14
SYMBOL LTspiceControlLibrary\\Math\\Operands\\and -1072 -1728 R0
SYMATTR InstName U15
SYMBOL LTspiceControlLibrary\\Math\\Operands\\and -1072 -1600 R0
SYMATTR InstName U16
SYMBOL SpecialFunctions\\sample -1760 -2016 R0
WINDOW 3 -64 -52 Left 2
SYMATTR Value Vhigh=1T Vlow=0
SYMATTR InstName A1
SYMBOL Digital\\buf1 -2048 -2112 R0
WINDOW 39 -7 95 Left 2
SYMATTR SpiceLine Td={Tedge}
SYMATTR InstName A2
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1488 -1952 R0
SYMATTR Value K={2*pi/6*Fclk}
SYMATTR InstName U17
SYMBOL LTspiceControlLibrary\\Math\\Operands\\rcp -1552 -1952 R0
SYMATTR InstName U18
SYMBOL LTspiceControlLibrary\\Math\\Operands\\or -2192 -1952 R0
SYMATTR InstName U19
SYMBOL LTspiceControlLibrary\\Math\\Operands\\or -2128 -1952 R0
SYMATTR InstName U20
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1392 -2016 R0
SYMATTR Value K={1/Np}
SYMATTR InstName U21
SYMBOL LTspiceControlLibrary\\PulseModulations\\BothEdgesDetector -2352 -1952 R0
SYMATTR Value Tedge={Tedge}
SYMATTR InstName U22
SYMBOL LTspiceControlLibrary\\PulseModulations\\BothEdgesDetector -2352 -1888 R0
SYMATTR Value Tedge={Tedge}
SYMATTR InstName U23
SYMBOL LTspiceControlLibrary\\PulseModulations\\BothEdgesDetector -2352 -1824 R0
SYMATTR Value Tedge={Tedge}
SYMATTR InstName U24
SYMBOL Digital\\srflop -1728 -1824 R0
SYMATTR InstName A3
SYMBOL LTspiceControlLibrary\\Math\\Functions\\if -1616 -1936 R0
SYMATTR InstName U25
SYMBOL voltage -1648 -1936 R0
SYMATTR InstName V3
SYMATTR Value 1T
SYMBOL LTspiceControlLibrary\\PulseModulations\\PulseTimer -1920 -2016 R0
SYMATTR Value F={Fclk}
SYMATTR InstName U26
SYMBOL Digital\\counter -1968 -1840 R0
WINDOW 3 -64 -52 Left 2
SYMATTR Value cycles=3*2
SYMATTR InstName A4
SYMBOL voltage -2336 -1520 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value PULSE(0 100)
SYMBOL sub -2256 -1536 R0
SYMATTR InstName U27
SYMBOL Proportional -2176 -1536 R0
SYMATTR Value K=2m
SYMATTR InstName U28
SYMBOL add -1904 -1536 R0
SYMATTR InstName U29
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Integral -2016 -1488 R0
SYMATTR Value T=10m
SYMATTR InstName U30
SYMBOL LTspiceControlLibrary\\Math\\Functions\\limit -1808 -1536 R0
SYMATTR Value y={Tpwmmin/Tcarrier} z=1+1m
SYMATTR InstName U31
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -1808 -1520 M90
SYMATTR InstName U32
SYMBOL sub -2080 -1488 R0
SYMATTR InstName U33
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -2064 -832 R0
SYMATTR Value K=0.5
SYMATTR InstName U34
SYMBOL LTspiceControlLibrary\\Math\\Operands\\lt -1968 -1264 R0
SYMATTR InstName U35
SYMBOL SpecialFunctions\\sample -1776 -1264 R0
WINDOW 3 -64 -52 Left 2
SYMATTR Value Vhigh=1 Vlow=0
SYMATTR InstName A5
SYMBOL LTspiceControlLibrary\\Math\\Operands\\lt -1968 -1072 R0
SYMATTR InstName U36
SYMBOL SpecialFunctions\\sample -1776 -1072 R0
WINDOW 3 -64 -52 Left 2
SYMATTR Value Vhigh=1 Vlow=0
SYMATTR InstName A6
SYMBOL LTspiceControlLibrary\\Math\\Operands\\lt -1968 -880 R0
SYMATTR InstName U37
SYMBOL SpecialFunctions\\sample -1776 -880 R0
WINDOW 3 -64 -52 Left 2
SYMATTR Value Vhigh=1 Vlow=0
SYMATTR InstName A7
SYMBOL LTspiceControlLibrary\\Math\\Operands\\or -2128 -608 R0
SYMATTR InstName U38
SYMBOL LTspiceControlLibrary\\Math\\Operands\\or -2064 -608 R0
SYMATTR InstName U39
SYMBOL LTspiceControlLibrary\\PulseModulations\\BothEdgesDetector -2256 -608 R0
SYMATTR Value Tedge={Tmask}
SYMATTR InstName U40
SYMBOL LTspiceControlLibrary\\PulseModulations\\BothEdgesDetector -2256 -544 R0
SYMATTR Value Tedge={Tmask}
SYMATTR InstName U41
SYMBOL LTspiceControlLibrary\\PulseModulations\\BothEdgesDetector -2256 -480 R0
SYMATTR Value Tedge={Tmask}
SYMATTR InstName U42
SYMBOL LTspiceControlLibrary\\Math\\Operands\\inv -2000 -608 R0
SYMATTR InstName U43
SYMBOL LTspiceControlLibrary\\Math\\Operands\\and -1968 -768 R0
SYMATTR InstName U44
SYMBOL LTspiceControlLibrary\\Math\\Operands\\rcp -1744 -704 R0
SYMATTR InstName U45
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1680 -704 R0
SYMATTR Value K={Pdelay}
SYMATTR InstName U46
SYMBOL LTspiceControlLibrary\\Math\\Functions\\if -1280 -1184 R0
SYMATTR InstName U47
SYMBOL LTspiceControlLibrary\\Math\\Functions\\if -1280 -992 R0
SYMATTR InstName U48
SYMBOL LTspiceControlLibrary\\Math\\Functions\\if -1280 -800 R0
SYMATTR InstName U49
SYMBOL LTspiceControlLibrary\\Math\\Functions\\if -1408 -1184 R0
SYMATTR InstName U50
SYMBOL LTspiceControlLibrary\\Math\\Functions\\if -1408 -992 R0
SYMATTR InstName U51
SYMBOL LTspiceControlLibrary\\Math\\Functions\\if -1408 -800 R0
SYMATTR InstName U52
SYMBOL voltage -1328 -800 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V5
SYMATTR Value PULSE(0 1 3m)
SYMBOL voltage -1456 -720 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V6
SYMATTR Value 1
SYMBOL LTspiceControlLibrary\\Math\\Functions\\delay2 -1584 -1216 R0
SYMATTR InstName U53
SYMBOL LTspiceControlLibrary\\Math\\Functions\\delay2 -1584 -1024 R0
SYMATTR InstName U54
SYMBOL LTspiceControlLibrary\\Math\\Functions\\delay2 -1584 -832 R0
SYMATTR InstName U55
SYMBOL voltage -2304 -800 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V7
SYMATTR Value PULSE(0 1 {Tpwmmin*0.99} .1n .1n .1n {Tcarrier})
TEXT -2408 -3040 Left 2 !.tran 200m startup
TEXT -2408 -3008 Left 2 !.model SW SW(Ron=.1 Roff=10k Vt=0.5)\n.model D D(Ron=.1 Roff=10k Vfwd=.4)
TEXT -2448 -3080 Left 4 ;Config
TEXT -2488 -3136 Left 5 ;PMSM 120-Degree Drive with Back-EMF Sensorless
TEXT -2448 -2944 Left 4 ;Circuit
TEXT -2440 -2184 Left 4 ;Controller
TEXT -1536 -2928 Left 2 ;Analogy between\nElectric Circuit  - Rotating Machinery\nQ: charge - Pm: angle\nI: current - Om: angular velocity\nV: voltage - Tm: torque\nR: resistance - Dm: viscous resistance\nL: inductance - Jm: moment of inertia\nC: capacitance - Km: torsion coefficient
TEXT -1128 -2592 Left 2 ;disturbance torque
TEXT -1592 -1632 Left 2 ;pwm
TEXT -2384 -2032 Left 2 !.param Tedge=1n
TEXT -2408 -2128 Left 2 ;speed calcurator
TEXT -1448 -2392 Left 2 !.param Np=3\n.param Plead=pi/24 Pdelay=pi/6-Plead
TEXT -2408 -1624 Left 2 ;speed controller
TEXT -2016 -1432 Left 2 ;antiwindup
TEXT -1896 -2120 Left 2 !.param Fclk=1Meg
TEXT -1200 -2024 Left 2 ;120-degree drive\nlow side pwm
TEXT -1808 -1856 Left 2 ;startup wait
TEXT -2328 -672 Left 2 !.param Tmask=350u
TEXT -1432 -1496 Left 2 !.param Tcarrier=100u\n.param Tpwmmin=4u
TEXT -1384 -1280 Left 2 ;startup state
TEXT -2400 -1352 Left 2 ;back-emf zero crossing detector
