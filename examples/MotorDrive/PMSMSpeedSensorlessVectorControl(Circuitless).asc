Version 4
SHEET 1 1304 1156
WIRE -1680 -576 -1712 -576
WIRE -1664 -576 -1680 -576
WIRE -1584 -576 -1600 -576
WIRE -1456 -576 -1520 -576
WIRE -1376 -576 -1456 -576
WIRE -1344 -576 -1376 -576
WIRE -1248 -576 -1280 -576
WIRE -1216 -576 -1248 -576
WIRE -368 -576 -1216 -576
WIRE -224 -576 -304 -576
WIRE -1712 -528 -1712 -576
WIRE -1456 -528 -1456 -576
WIRE -1376 -528 -1392 -528
WIRE -1312 -528 -1312 -544
WIRE -1312 -528 -1376 -528
WIRE -400 -512 -448 -512
WIRE -336 -512 -336 -544
WIRE 16 -512 -16 -512
WIRE 32 -512 16 -512
WIRE 112 -512 96 -512
WIRE 112 -496 112 -512
WIRE 128 -496 112 -496
WIRE 144 -496 128 -496
WIRE 320 -496 272 -496
WIRE 384 -496 320 -496
WIRE -224 -480 -224 -576
WIRE -192 -480 -224 -480
WIRE -176 -480 -192 -480
WIRE -96 -480 -112 -480
WIRE -16 -480 -16 -512
WIRE -16 -480 -32 -480
WIRE 384 -480 384 -496
WIRE -192 -448 -224 -448
WIRE -176 -448 -192 -448
WIRE -96 -448 -112 -448
WIRE 16 -448 -32 -448
WIRE 128 -448 16 -448
WIRE 144 -448 128 -448
WIRE -16 -416 -32 -416
WIRE 128 -400 112 -400
WIRE 144 -400 128 -400
WIRE 288 -400 272 -400
WIRE 304 -400 288 -400
WIRE 384 -400 368 -400
WIRE -16 -384 -16 -416
WIRE 16 -384 -16 -384
WIRE 48 -384 16 -384
WIRE 112 -384 112 -400
WIRE -2656 -368 -2672 -368
WIRE -2640 -368 -2656 -368
WIRE -2448 -368 -2512 -368
WIRE -2432 -368 -2448 -368
WIRE -2304 -368 -2368 -368
WIRE -2272 -368 -2304 -368
WIRE -2128 -368 -2144 -368
WIRE -2048 -368 -2064 -368
WIRE -2032 -368 -2048 -368
WIRE -1888 -368 -1920 -368
WIRE -1856 -368 -1888 -368
WIRE -1840 -368 -1856 -368
WIRE -1728 -368 -1776 -368
WIRE -1712 -368 -1728 -368
WIRE -1584 -368 -1648 -368
WIRE -1456 -368 -1520 -368
WIRE -1376 -368 -1456 -368
WIRE -1344 -368 -1376 -368
WIRE -1264 -368 -1280 -368
WIRE -1248 -368 -1264 -368
WIRE -368 -368 -1248 -368
WIRE -224 -368 -224 -448
WIRE -224 -368 -240 -368
WIRE -2048 -336 -2048 -368
WIRE 288 -336 288 -400
WIRE -2672 -320 -2672 -368
WIRE -1456 -320 -1456 -368
WIRE -1376 -320 -1392 -320
WIRE -1312 -320 -1312 -336
WIRE -1312 -320 -1376 -320
WIRE -512 -320 -512 -512
WIRE -464 -320 -512 -320
WIRE -336 -320 -336 -336
WIRE -2448 -304 -2448 -368
WIRE -2416 -304 -2448 -304
WIRE -2272 -304 -2288 -304
WIRE -2240 -304 -2240 -336
WIRE -2240 -304 -2272 -304
WIRE -1856 -304 -1856 -368
WIRE -1856 -304 -2016 -304
WIRE -512 -256 -512 -320
WIRE -400 -256 -512 -256
WIRE -272 -256 -272 -336
WIRE -272 -256 -336 -256
WIRE -144 -256 -144 -400
WIRE -144 -256 -224 -256
WIRE -2384 -224 -2384 -272
WIRE -2048 -224 -2048 -272
WIRE -2048 -224 -2384 -224
WIRE -1632 -208 -1632 -544
WIRE -1472 -208 -1632 -208
WIRE -432 -208 -432 -288
WIRE -432 -208 -1472 -208
WIRE -192 -208 -432 -208
WIRE -176 -208 -192 -208
WIRE -96 -208 -112 -208
WIRE 16 -208 -32 -208
WIRE 64 -208 64 -496
WIRE 64 -208 16 -208
WIRE -2608 -192 -2608 -336
WIRE -2432 -192 -2608 -192
WIRE -2176 -192 -2176 -336
WIRE -2176 -192 -2368 -192
WIRE -1680 -176 -1680 -336
WIRE -1504 -176 -1680 -176
WIRE -480 -176 -480 -480
WIRE -480 -176 -1504 -176
WIRE -192 -176 -480 -176
WIRE -176 -176 -192 -176
WIRE -96 -176 -112 -176
WIRE 16 -144 -32 -144
WIRE 80 -144 80 -368
WIRE 80 -144 16 -144
WIRE -1216 -128 -1216 -576
WIRE -1472 -96 -1472 -208
WIRE -1456 -96 -1472 -96
WIRE -1248 -96 -1392 -96
WIRE -1104 -96 -1120 -96
WIRE -1024 -96 -1040 -96
WIRE -944 -96 -960 -96
WIRE -784 -96 -944 -96
WIRE -704 -96 -720 -96
WIRE -624 -96 -640 -96
WIRE -544 -96 -560 -96
WIRE -224 -96 -224 -256
WIRE -224 -96 -544 -96
WIRE -208 -96 -224 -96
WIRE -144 -96 -144 -128
WIRE -2608 -80 -2608 -192
WIRE -2384 -80 -2608 -80
WIRE -2176 -80 -2288 -80
WIRE -2096 -80 -2096 -336
WIRE -2096 -80 -2112 -80
WIRE -1264 -64 -1264 -368
WIRE -1152 -64 -1200 -64
WIRE -2144 -32 -2144 -48
WIRE -2128 -32 -2144 -32
WIRE -1856 -32 -1856 -304
WIRE -1856 -32 -2032 -32
WIRE -1504 -32 -1504 -176
WIRE -1456 -32 -1504 -32
WIRE -1296 -32 -1392 -32
WIRE -1072 -32 -1072 -64
WIRE -1072 -32 -1232 -32
WIRE -944 -32 -944 -96
WIRE -928 -32 -944 -32
WIRE -848 -32 -864 -32
WIRE -752 -32 -752 -64
WIRE -752 -32 -784 -32
WIRE -544 -32 -752 -32
WIRE -512 -32 -512 -256
WIRE -512 -32 -544 -32
WIRE -176 16 -192 16
WIRE -96 16 -112 16
WIRE 64 16 64 -208
WIRE 64 16 -32 16
WIRE -928 32 -944 32
WIRE -816 32 -816 0
WIRE -816 32 -864 32
WIRE -176 48 -192 48
WIRE -96 48 -112 48
WIRE -1472 80 -1472 -96
WIRE -1456 80 -1472 80
WIRE -1184 80 -1392 80
WIRE -1104 80 -1120 80
WIRE -1024 80 -1040 80
WIRE -944 80 -944 32
WIRE -944 80 -960 80
WIRE -592 80 -592 -64
WIRE -592 80 -944 80
WIRE 80 80 80 -144
WIRE 80 80 -32 80
WIRE -1200 112 -1200 -64
WIRE -1152 112 -1200 112
WIRE -144 128 -144 96
WIRE -128 128 -144 128
WIRE 64 128 -64 128
WIRE 96 128 64 128
WIRE 176 128 160 128
WIRE 192 128 176 128
WIRE 272 128 256 128
WIRE 304 128 272 128
WIRE 336 128 336 -384
WIRE 336 128 304 128
WIRE -1504 144 -1504 -32
WIRE -1456 144 -1504 144
WIRE -1072 144 -1072 112
WIRE -1072 144 -1392 144
WIRE -1296 176 -1312 176
WIRE -1200 176 -1200 112
WIRE -1200 176 -1216 176
WIRE 96 192 64 192
WIRE 272 192 272 128
WIRE 272 192 160 192
WIRE -2608 224 -2608 -80
WIRE -1872 224 -2608 224
WIRE -1840 224 -1872 224
WIRE -1312 224 -1312 176
WIRE -1312 224 -1776 224
WIRE -512 224 -512 -32
WIRE -512 224 -1312 224
FLAG 16 -208 iu
FLAG 16 -144 iw
FLAG -192 -208 id^
FLAG -192 -176 iq^
FLAG -1680 -576 id*
FLAG -1376 -576 vd*_p
FLAG -1376 -528 vd*_i
FLAG -1712 -448 0
FLAG -1728 -368 iq*
FLAG -1376 -368 vq*_p
FLAG -1376 -320 vq*_i
FLAG -192 -480 vd*
FLAG -192 -448 vq*
FLAG 16 -512 vu*
FLAG 16 -448 vv*
FLAG 16 -384 vw*
FLAG 288 -336 0
FLAG 304 128 om
FLAG 176 128 pm
FLAG 64 128 pe
FLAG 320 -496 Tm
FLAG 64 192 oe
FLAG -2656 -368 om*
FLAG -2304 -368 tm*_p
FLAG -2272 -304 tm*_i
FLAG -2672 -240 0
FLAG -1888 -368 tm*
FLAG 128 -496 U
FLAG 128 -448 V
FLAG 128 -400 W
FLAG -544 -32 oe^
FLAG -544 -96 pe^
FLAG -1872 224 om^
FLAG -192 16 id
FLAG -192 48 iq
FLAG -1248 -576 vd*_pi
FLAG -1248 -368 vq*_pi
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\uw-abTransformation -32 -256 M0
SYMATTR InstName U2
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\xyRotation -112 -256 M0
SYMATTR InstName U4
SYMBOL LTspiceControlLibrary\\Math\\Operands\\neg -192 -64 R0
SYMATTR InstName U6
SYMBOL sub -1648 -544 R0
SYMATTR InstName U7
SYMBOL Integral -1440 -496 R0
SYMATTR Value T={Tiid}
SYMATTR InstName U8
SYMBOL Proportional -1568 -544 R0
SYMATTR Value K={Kpid}
SYMATTR InstName U10
SYMBOL add -1328 -544 R0
SYMATTR InstName U11
SYMBOL voltage -1712 -544 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value {0*sqrt(3)}
SYMBOL sub -1696 -336 R0
SYMATTR InstName U12
SYMBOL Integral -1440 -288 R0
SYMATTR Value T={Tiiq}
SYMATTR InstName U13
SYMBOL Proportional -1568 -336 R0
SYMATTR Value K={Kpiq}
SYMATTR InstName U14
SYMBOL add -1328 -336 R0
SYMATTR InstName U15
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\xyRotation -176 -528 R0
SYMATTR InstName U16
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\ab-uvwTransformation -96 -528 R0
SYMATTR InstName U17
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Integral 240 160 M0
SYMATTR InstName U9
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional 144 160 M0
SYMATTR Value K={Np}
SYMATTR InstName U30
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional 144 224 M0
SYMATTR Value K={Np}
SYMATTR InstName U23
SYMBOL LTspiceControlLibrary\\Motors\\PMSMotor 272 -448 R0
SYMATTR InstName U1
SYMATTR Value Ra={Ra} Ld={Ld} Lq={Lq} Ke={Ke} Dm={Dm} Jm={Jm} Np={Np}
SYMBOL voltage 384 -496 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value PULSE(0 20m 0.2 1n 1n 0.2)
SYMBOL sub -2624 -336 R0
SYMATTR InstName U5
SYMBOL Integral -2336 -272 R0
SYMATTR InstName U3
SYMATTR Value T={Tiom}
SYMBOL Proportional -2416 -336 R0
SYMATTR Value K={wpom}
SYMATTR InstName U18
SYMBOL add -2256 -336 R0
SYMATTR InstName U19
SYMBOL Proportional -1824 -336 R0
SYMATTR Value K={1/(Ke1*Np)}
SYMATTR InstName U20
SYMBOL LTspiceControlLibrary\\Math\\Functions\\limit -2016 -336 R0
SYMATTR Value y=-z z={Tmlimit}
SYMATTR InstName U26
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -2400 -272 R0
SYMATTR InstName U27
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -2016 -320 M90
SYMATTR InstName U28
SYMBOL LTspiceControlLibrary\\Math\\Operands\\add -2192 -336 R0
SYMATTR InstName U22
SYMBOL Proportional -2416 -160 R0
SYMATTR Value K={(wpom-1)*Kpom}
SYMATTR InstName U21
SYMBOL Proportional -2560 -336 R0
SYMATTR Value K={Kpom}
SYMATTR InstName U24
SYMBOL LTspiceControlLibrary\\TransferFunctions\\LaggedDerivative -2368 -48 R0
SYMATTR Value i={Tlpfdo}/T T={Jm}
SYMATTR InstName U25
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -2112 -336 R0
SYMATTR InstName U29
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -2160 -48 R0
SYMATTR InstName U31
SYMBOL LTspiceControlLibrary\\TransferFunctions\\1stOrderLag -2048 0 M0
WINDOW 3 65 4 Right 2
SYMATTR Value K=1 T={Tlpfdo}
SYMATTR InstName U32
SYMBOL LTspiceControlLibrary\\Math\\Operands\\mul -448 -288 R0
SYMATTR InstName U34
SYMBOL Proportional -384 -288 R0
SYMATTR Value K={Ld1}
SYMATTR InstName U35
SYMBOL Proportional -384 -224 R0
SYMATTR Value K={Ke1}
SYMATTR InstName U36
SYMBOL LTspiceControlLibrary\\Math\\Operands\\mul -496 -480 R0
SYMATTR InstName U37
SYMBOL Proportional -384 -480 R0
SYMATTR Value K=-{Lq1}
SYMATTR InstName U38
SYMBOL LTspiceControlLibrary\\Math\\Operands\\add -352 -544 R0
SYMATTR InstName U39
SYMBOL LTspiceControlLibrary\\Math\\Operands\\add -352 -336 R0
SYMATTR InstName U40
SYMBOL LTspiceControlLibrary\\Math\\Operands\\add -288 -336 R0
SYMATTR InstName U41
SYMBOL voltage -2672 -336 R0
WINDOW 123 24 44 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value2 AC 1
SYMATTR InstName V1
SYMATTR Value 100
SYMBOL LTspiceControlLibrary\\Sensors\\CurrentSensor 64 -512 R0
SYMATTR InstName U33
SYMBOL LTspiceControlLibrary\\Sensors\\CurrentSensor 80 -384 R0
SYMATTR InstName U42
SYMBOL LTspiceControlLibrary\\Sensors\\CurrentSensor 336 -400 M0
SYMATTR InstName U43
SYMBOL Proportional -1440 -64 R0
SYMATTR Value K={Ra1}
SYMATTR InstName U44
SYMBOL Proportional -1440 0 R0
SYMATTR Value K={Ra1}
SYMATTR InstName U45
SYMBOL Proportional -1008 -64 R0
SYMATTR Value K={1/Ke1}
SYMATTR InstName U46
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -1280 -64 M180
SYMATTR InstName U49
SYMBOL LTspiceControlLibrary\\Math\\Operands\\mul -1168 -64 R0
SYMATTR InstName U50
SYMBOL LTspiceControlLibrary\\Math\\Functions\\sgn -1280 208 R0
SYMATTR InstName U51
SYMBOL Integral -688 -64 R0
SYMATTR InstName U52
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -1232 -128 M180
SYMATTR InstName U53
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -1088 -64 R0
SYMATTR InstName U54
SYMBOL LTspiceControlLibrary\\Math\\Operands\\add -768 -64 R0
SYMATTR InstName U55
SYMBOL Integral -912 0 R0
SYMATTR InstName U58
SYMATTR Value T={Tioe}
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1792 256 M0
WINDOW 3 32 -2 Right 2
SYMATTR Value K={1/Np}
SYMATTR InstName U59
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\uw-abTransformation -32 -32 M0
SYMATTR InstName U60
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\xyRotation -112 -32 M0
SYMATTR InstName U61
SYMBOL LTspiceControlLibrary\\Math\\Operands\\neg -80 160 M0
SYMATTR InstName U62
SYMBOL Proportional -1440 112 R0
SYMATTR Value K={Ld1}
SYMATTR InstName U47
SYMBOL Proportional -1440 176 R0
SYMATTR Value K={Lq1}
SYMATTR InstName U48
SYMBOL LTspiceControlLibrary\\Math\\Operands\\mul -1168 112 R0
SYMATTR InstName U56
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -1088 112 R0
SYMATTR InstName U57
SYMBOL Proportional -1008 112 R0
SYMATTR Value K={1/Ke1}
SYMATTR InstName U63
SYMBOL Proportional -912 64 R0
SYMATTR Value K={1/Tioe}
SYMATTR InstName U64
SYMBOL LTspiceControlLibrary\\Math\\Operands\\add -832 0 R0
SYMATTR InstName U65
SYMBOL LTspiceControlLibrary\\Math\\Operands\\add -608 -64 R0
SYMATTR InstName U66
TEXT 160 -240 Left 2 ;sensor
TEXT -1720 -632 Left 2 ;current controller
TEXT -232 -632 Left 2 ;coordinate transformation
TEXT -112 -872 Left 2 !** PMSM parameters\n.params Ra=0.35/2 Ld=0.35m/2 Lq=0.35m/2\n.params Ke=15.0m/sqrt(2)/Np Dm=Jm/0.3 Jm=2.40u Np=4
TEXT -1776 -872 Left 2 !** current control parameters\n.params Oci=5000\n.params wi=0.2\n.params Kpid=Ld1*Oci\n.params Tiid=1/(wi*(1-wi)*Oci)\n.params Kpiq=Lq1*Oci\n.params Tiiq=1/(wi*(1-wi)*Oci)
TEXT -2408 -864 Left 2 !** speed control parameters\n.params Ocom=0.1*Oci\n.params wom=0.2\n.params Kpom=Jm1*Ocom\n.params Tiom=1/(wom*(1-wom)*Ocom)\n.params wpom=0.8\n.params Tlpfdo=5m\n.params Tmlimit=31m
TEXT -2688 -472 Left 2 ;speed controller
TEXT -2656 -896 Left 2 !.tran 0.5 startup
TEXT -2696 -936 Left 4 ;Config
TEXT -2736 -992 Left 5 ;PMSM Speed Sensorless Vector Control
TEXT -2696 -624 Left 4 ;Control System
TEXT -424 -416 Left 2 ;decoupler
TEXT -2328 -120 Left 2 ;disturbance observer
TEXT -2312 -240 Left 2 ;antiwindup
TEXT -2456 -408 Left 2 ;two-degree-of-freedom PI controller
TEXT -1504 -416 Left 2 ;PI controller
TEXT 392 -504 Left 2 ;disturbance torque
TEXT 208 -760 Left 2 ;Analogy between\nElectric Circuit  - Rotating Machinery\nQ: charge - Pm: angle\nI: current - Om: angular velocity\nV: voltage - Tm: torque\nR: resistance - Dm: viscous resistance\nL: inductance - Jm: moment of inertia\nC: capacitance - Km: torsion coefficient
TEXT -1112 -144 Left 2 ;angle and speed observer
TEXT -1224 -872 Left 2 !** angle and speed observer parameter\n.params Tioe=1m\n \n** PMSM estimated parameters\n.params Ra1=0.9*Ra Ld1=0.9*Ld Lq1=0.9*Lq\n.params Ke1=0.9*Ke Dm1=0.9*Dm Jm1=0.9*Jm
