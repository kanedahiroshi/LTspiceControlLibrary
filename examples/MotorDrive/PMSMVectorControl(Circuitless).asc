Version 4
SHEET 1 1304 1156
WIRE -1680 -576 -1712 -576
WIRE -1664 -576 -1680 -576
WIRE -1584 -576 -1600 -576
WIRE -1456 -576 -1520 -576
WIRE -1376 -576 -1456 -576
WIRE -1344 -576 -1376 -576
WIRE -1120 -576 -1280 -576
WIRE -976 -576 -1056 -576
WIRE -1712 -528 -1712 -576
WIRE -1456 -528 -1456 -576
WIRE -1376 -528 -1392 -528
WIRE -1312 -528 -1312 -544
WIRE -1312 -528 -1376 -528
WIRE -1152 -512 -1200 -512
WIRE -1088 -512 -1088 -544
WIRE -736 -512 -768 -512
WIRE -720 -512 -736 -512
WIRE -640 -512 -656 -512
WIRE -640 -496 -640 -512
WIRE -624 -496 -640 -496
WIRE -608 -496 -624 -496
WIRE -432 -496 -480 -496
WIRE -368 -496 -432 -496
WIRE -976 -480 -976 -576
WIRE -944 -480 -976 -480
WIRE -928 -480 -944 -480
WIRE -848 -480 -864 -480
WIRE -768 -480 -768 -512
WIRE -768 -480 -784 -480
WIRE -368 -480 -368 -496
WIRE -944 -448 -976 -448
WIRE -928 -448 -944 -448
WIRE -848 -448 -864 -448
WIRE -736 -448 -784 -448
WIRE -624 -448 -736 -448
WIRE -608 -448 -624 -448
WIRE -768 -416 -784 -416
WIRE -624 -400 -640 -400
WIRE -608 -400 -624 -400
WIRE -464 -400 -480 -400
WIRE -448 -400 -464 -400
WIRE -368 -400 -384 -400
WIRE -768 -384 -768 -416
WIRE -736 -384 -768 -384
WIRE -704 -384 -736 -384
WIRE -640 -384 -640 -400
WIRE -2656 -368 -2672 -368
WIRE -2640 -368 -2656 -368
WIRE -2448 -368 -2512 -368
WIRE -2432 -368 -2448 -368
WIRE -2304 -368 -2368 -368
WIRE -2272 -368 -2304 -368
WIRE -2128 -368 -2144 -368
WIRE -2048 -368 -2064 -368
WIRE -2032 -368 -2048 -368
WIRE -1888 -368 -1920 -368
WIRE -1856 -368 -1888 -368
WIRE -1840 -368 -1856 -368
WIRE -1728 -368 -1776 -368
WIRE -1712 -368 -1728 -368
WIRE -1584 -368 -1648 -368
WIRE -1456 -368 -1520 -368
WIRE -1376 -368 -1456 -368
WIRE -1344 -368 -1376 -368
WIRE -1120 -368 -1280 -368
WIRE -976 -368 -976 -448
WIRE -976 -368 -992 -368
WIRE -896 -352 -896 -400
WIRE -768 -352 -896 -352
WIRE -2048 -336 -2048 -368
WIRE -464 -336 -464 -400
WIRE -2672 -320 -2672 -368
WIRE -1456 -320 -1456 -368
WIRE -1376 -320 -1392 -320
WIRE -1312 -320 -1312 -336
WIRE -1312 -320 -1376 -320
WIRE -1264 -320 -1264 -512
WIRE -1216 -320 -1264 -320
WIRE -1088 -320 -1088 -336
WIRE -2448 -304 -2448 -368
WIRE -2416 -304 -2448 -304
WIRE -2272 -304 -2288 -304
WIRE -2240 -304 -2240 -336
WIRE -2240 -304 -2272 -304
WIRE -1856 -304 -1856 -368
WIRE -1856 -304 -2016 -304
WIRE -1264 -256 -1264 -320
WIRE -1152 -256 -1264 -256
WIRE -1024 -256 -1024 -336
WIRE -1024 -256 -1088 -256
WIRE -2384 -224 -2384 -272
WIRE -2048 -224 -2048 -272
WIRE -2048 -224 -2384 -224
WIRE -1632 -208 -1632 -544
WIRE -1184 -208 -1184 -288
WIRE -1184 -208 -1632 -208
WIRE -944 -208 -1184 -208
WIRE -928 -208 -944 -208
WIRE -848 -208 -864 -208
WIRE -736 -208 -784 -208
WIRE -688 -208 -688 -496
WIRE -688 -208 -736 -208
WIRE -2608 -192 -2608 -336
WIRE -2432 -192 -2608 -192
WIRE -2176 -192 -2176 -336
WIRE -2176 -192 -2368 -192
WIRE -1680 -176 -1680 -336
WIRE -1232 -176 -1232 -480
WIRE -1232 -176 -1680 -176
WIRE -944 -176 -1232 -176
WIRE -928 -176 -944 -176
WIRE -848 -176 -864 -176
WIRE -736 -144 -784 -144
WIRE -672 -144 -672 -368
WIRE -672 -144 -736 -144
WIRE -896 -96 -896 -128
WIRE -880 -96 -896 -96
WIRE -768 -96 -768 -352
WIRE -768 -96 -816 -96
WIRE -688 -96 -768 -96
WIRE -656 -96 -688 -96
WIRE -576 -96 -592 -96
WIRE -560 -96 -576 -96
WIRE -480 -96 -496 -96
WIRE -448 -96 -480 -96
WIRE -416 -96 -416 -384
WIRE -416 -96 -448 -96
WIRE -2608 -80 -2608 -192
WIRE -2384 -80 -2608 -80
WIRE -2176 -80 -2288 -80
WIRE -2096 -80 -2096 -336
WIRE -2096 -80 -2112 -80
WIRE -2144 -32 -2144 -48
WIRE -2128 -32 -2144 -32
WIRE -1856 -32 -1856 -304
WIRE -1856 -32 -2032 -32
WIRE -1264 -32 -1264 -256
WIRE -768 -32 -1264 -32
WIRE -656 -32 -768 -32
WIRE -480 -32 -480 -96
WIRE -480 -32 -592 -32
WIRE -2608 32 -2608 -80
WIRE -416 32 -416 -96
WIRE -416 32 -2608 32
FLAG -736 -208 iu
FLAG -736 -144 iw
FLAG -944 -208 id
FLAG -944 -176 iq
FLAG -1680 -576 id*
FLAG -1376 -576 vd*_p
FLAG -1376 -528 vd*_i
FLAG -1712 -448 0
FLAG -1728 -368 iq*
FLAG -1376 -368 vq*_p
FLAG -1376 -320 vq*_i
FLAG -944 -480 vd*
FLAG -944 -448 vq*
FLAG -736 -512 vu*
FLAG -736 -448 vv*
FLAG -736 -384 vw*
FLAG -464 -336 0
FLAG -448 -96 om
FLAG -576 -96 pm
FLAG -688 -96 pe
FLAG -432 -496 Tm
FLAG -768 -32 oe
FLAG -2656 -368 om*
FLAG -2304 -368 tm*_p
FLAG -2272 -304 tm*_i
FLAG -2672 -240 0
FLAG -1888 -368 tm*
FLAG -624 -496 U
FLAG -624 -448 V
FLAG -624 -400 W
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\uw-abTransformation -784 -256 M0
SYMATTR InstName U2
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\xyRotation -864 -256 M0
SYMATTR InstName U4
SYMBOL LTspiceControlLibrary\\Math\\Operands\\neg -832 -64 M0
SYMATTR InstName U6
SYMBOL sub -1648 -544 R0
SYMATTR InstName U7
SYMBOL Integral -1440 -496 R0
SYMATTR Value T={Tiid}
SYMATTR InstName U8
SYMBOL Proportional -1568 -544 R0
SYMATTR Value K={Kpid}
SYMATTR InstName U10
SYMBOL add -1328 -544 R0
SYMATTR InstName U11
SYMBOL voltage -1712 -544 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value {0*sqrt(3)}
SYMBOL sub -1696 -336 R0
SYMATTR InstName U12
SYMBOL Integral -1440 -288 R0
SYMATTR Value T={Tiiq}
SYMATTR InstName U13
SYMBOL Proportional -1568 -336 R0
SYMATTR Value K={Kpiq}
SYMATTR InstName U14
SYMBOL add -1328 -336 R0
SYMATTR InstName U15
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\xyRotation -928 -528 R0
SYMATTR InstName U16
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\ab-uvwTransformation -848 -528 R0
SYMATTR InstName U17
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Integral -512 -64 M0
SYMATTR InstName U9
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -608 -64 M0
SYMATTR Value K={Np}
SYMATTR InstName U30
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -608 0 M0
SYMATTR Value K={Np}
SYMATTR InstName U23
SYMBOL LTspiceControlLibrary\\Motors\\PMSMotor -480 -448 R0
SYMATTR InstName U1
SYMATTR Value Ra={Ra} Ld={Ld} Lq={Lq} Ke={Ke} Dm={Dm} Jm={Jm} Np={Np}
SYMBOL voltage -368 -496 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value PULSE(0 20m 0.2 1n 1n 0.2)
SYMBOL sub -2624 -336 R0
SYMATTR InstName U5
SYMBOL Integral -2336 -272 R0
SYMATTR InstName U3
SYMATTR Value T={Tiom}
SYMBOL Proportional -2416 -336 R0
SYMATTR Value K={wpom}
SYMATTR InstName U18
SYMBOL add -2256 -336 R0
SYMATTR InstName U19
SYMBOL Proportional -1824 -336 R0
SYMATTR Value K={1/(Ke*Np)}
SYMATTR InstName U20
SYMBOL LTspiceControlLibrary\\Math\\Functions\\limit -2016 -336 R0
WINDOW 3 0 0 Left 2
SYMATTR Value y=-z z={Tmlimit}
SYMATTR InstName U26
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -2400 -272 R0
SYMATTR InstName U27
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -2016 -320 M90
SYMATTR InstName U28
SYMBOL LTspiceControlLibrary\\Math\\Operands\\add -2192 -336 R0
SYMATTR InstName U22
SYMBOL Proportional -2416 -160 R0
SYMATTR Value K={(wpom-1)*Kpom}
SYMATTR InstName U21
SYMBOL Proportional -2560 -336 R0
SYMATTR Value K={Kpom}
SYMATTR InstName U24
SYMBOL LTspiceControlLibrary\\TransferFunctions\\LaggedDerivative -2368 -48 R0
SYMATTR Value i={Tlpfdo}/T T={Jm}
SYMATTR InstName U25
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -2112 -336 R0
SYMATTR InstName U29
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -2160 -48 R0
SYMATTR InstName U31
SYMBOL LTspiceControlLibrary\\TransferFunctions\\1stOrderLag -2048 0 M0
WINDOW 3 65 4 Right 2
SYMATTR Value K=1 T={Tlpfdo}
SYMATTR InstName U32
SYMBOL LTspiceControlLibrary\\Math\\Operands\\mul -1200 -288 R0
SYMATTR InstName U34
SYMBOL Proportional -1136 -288 R0
SYMATTR Value K={Ld}
SYMATTR InstName U35
SYMBOL Proportional -1136 -224 R0
SYMATTR Value K={Ke}
SYMATTR InstName U36
SYMBOL LTspiceControlLibrary\\Math\\Operands\\mul -1248 -480 R0
SYMATTR InstName U37
SYMBOL Proportional -1136 -480 R0
SYMATTR Value K=-{Lq}
SYMATTR InstName U38
SYMBOL LTspiceControlLibrary\\Math\\Operands\\add -1104 -544 R0
SYMATTR InstName U39
SYMBOL LTspiceControlLibrary\\Math\\Operands\\add -1104 -336 R0
SYMATTR InstName U40
SYMBOL LTspiceControlLibrary\\Math\\Operands\\add -1040 -336 R0
SYMATTR InstName U41
SYMBOL voltage -2672 -336 R0
WINDOW 123 24 44 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value2 AC 1
SYMATTR InstName V1
SYMATTR Value 100
SYMBOL LTspiceControlLibrary\\Sensors\\CurrentSensor -688 -512 R0
SYMATTR InstName U33
SYMBOL LTspiceControlLibrary\\Sensors\\CurrentSensor -672 -384 R0
SYMATTR InstName U42
SYMBOL LTspiceControlLibrary\\Sensors\\CurrentSensor -416 -400 M0
SYMATTR InstName U43
TEXT -592 -240 Left 2 ;sensor
TEXT -1720 -632 Left 2 ;current controller
TEXT -984 -632 Left 2 ;coordinate transformation
TEXT -864 -872 Left 2 !** PMSM parameters\n.params Ra=0.35/2 Ld=0.35m/2 Lq=0.35m/2\n.params Ke=15.0m/sqrt(2)/Np Dm=Jm/0.3 Jm=2.40u Np=4
TEXT -1776 -872 Left 2 !** current control parameters\n.params Oci=5000\n.params wi=0.2\n.params Kpid=Ld*Oci\n.params Tiid=1/(wi*(1-wi)*Oci)\n.params Kpiq=Lq*Oci\n.params Tiiq=1/(wi*(1-wi)*Oci)
TEXT -2408 -864 Left 2 !** speed control parameters\n.params Ocom=0.1*Oci\n.params wom=0.2\n.params Kpom=Jm*Ocom\n.params Tiom=1/(wom*(1-wom)*Ocom)\n.params wpom=0.8\n.params Tlpfdo=5m\n.params Tmlimit=31m
TEXT -2688 -472 Left 2 ;speed controller
TEXT -2656 -896 Left 2 !.tran 0.5 startup
TEXT -2696 -936 Left 4 ;Config
TEXT -2736 -992 Left 5 ;PMSM Vector Control with 2 Currents and Speed Sensing
TEXT -2696 -624 Left 4 ;Control System
TEXT -1176 -416 Left 2 ;decoupler
TEXT -2328 -120 Left 2 ;disturbance observer
TEXT -2312 -240 Left 2 ;antiwindup
TEXT -2456 -408 Left 2 ;two-degree-of-freedom PI controller
TEXT -1504 -416 Left 2 ;PI controller
TEXT -360 -504 Left 2 ;disturbance torque
TEXT -544 -760 Left 2 ;Analogy between\nElectric Circuit  - Rotating Machinery\nQ: charge - Pm: angle\nI: current - Om: angular velocity\nV: voltage - Tm: torque\nR: resistance - Dm: viscous resistance\nL: inductance - Jm: moment of inertia\nC: capacitance - Km: torsion coefficient
