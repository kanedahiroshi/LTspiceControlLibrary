Version 4
SHEET 1 1304 1156
WIRE -1968 -1024 -2208 -1024
WIRE -1712 -1024 -1968 -1024
WIRE -1488 -1024 -1712 -1024
WIRE -1968 -992 -1968 -1024
WIRE -1888 -992 -1968 -992
WIRE -1712 -992 -1712 -1024
WIRE -1632 -992 -1712 -992
WIRE -1488 -992 -1488 -1024
WIRE -1408 -992 -1488 -992
WIRE -1968 -976 -1968 -992
WIRE -1888 -976 -1888 -992
WIRE -1712 -976 -1712 -992
WIRE -1632 -976 -1632 -992
WIRE -1488 -976 -1488 -992
WIRE -1408 -976 -1408 -992
WIRE -1968 -880 -1968 -896
WIRE -1888 -880 -1888 -912
WIRE -1888 -880 -1968 -880
WIRE -1712 -880 -1712 -896
WIRE -1632 -880 -1632 -912
WIRE -1632 -880 -1712 -880
WIRE -1488 -880 -1488 -896
WIRE -1408 -880 -1408 -912
WIRE -1408 -880 -1488 -880
WIRE -1968 -816 -1968 -880
WIRE -1456 -816 -1968 -816
WIRE -1392 -816 -1456 -816
WIRE -1280 -816 -1328 -816
WIRE -2208 -768 -2208 -1024
WIRE -1280 -768 -1280 -816
WIRE -1248 -768 -1280 -768
WIRE -1072 -768 -1120 -768
WIRE -1008 -768 -1072 -768
WIRE -1008 -752 -1008 -768
WIRE -1712 -720 -1712 -880
WIRE -1456 -720 -1712 -720
WIRE -1248 -720 -1456 -720
WIRE -1248 -672 -1280 -672
WIRE -1104 -672 -1120 -672
WIRE -1008 -672 -1104 -672
WIRE -1488 -624 -1488 -880
WIRE -1456 -624 -1488 -624
WIRE -1392 -624 -1456 -624
WIRE -1280 -624 -1280 -672
WIRE -1280 -624 -1328 -624
WIRE -1104 -608 -1104 -672
WIRE -1968 -576 -1968 -816
WIRE -1888 -576 -1968 -576
WIRE -1712 -576 -1712 -720
WIRE -1632 -576 -1712 -576
WIRE -1488 -576 -1488 -624
WIRE -1408 -576 -1488 -576
WIRE -1968 -560 -1968 -576
WIRE -1712 -560 -1712 -576
WIRE -1488 -560 -1488 -576
WIRE -1888 -544 -1888 -576
WIRE -1632 -544 -1632 -576
WIRE -1408 -544 -1408 -576
WIRE -1968 -464 -1968 -480
WIRE -1888 -464 -1888 -480
WIRE -1888 -464 -1968 -464
WIRE -1712 -464 -1712 -480
WIRE -1632 -464 -1632 -480
WIRE -1632 -464 -1712 -464
WIRE -1488 -464 -1488 -480
WIRE -1408 -464 -1408 -480
WIRE -1408 -464 -1488 -464
WIRE -2208 -432 -2208 -688
WIRE -1968 -432 -1968 -464
WIRE -1968 -432 -2208 -432
WIRE -1712 -432 -1712 -464
WIRE -1712 -432 -1968 -432
WIRE -1488 -432 -1488 -464
WIRE -1488 -432 -1712 -432
WIRE -2208 -400 -2208 -432
WIRE -752 -256 -768 -256
WIRE -1344 -240 -1376 -240
WIRE -1280 -240 -1344 -240
WIRE -1200 -240 -1216 -240
WIRE -1040 -240 -1200 -240
WIRE -960 -240 -976 -240
WIRE -928 -240 -960 -240
WIRE -752 -224 -768 -224
WIRE -2192 -208 -2208 -208
WIRE -2016 -208 -2192 -208
WIRE -1824 -208 -1920 -208
WIRE -1744 -208 -1760 -208
WIRE -1664 -208 -1680 -208
WIRE -1536 -208 -1552 -208
WIRE -1456 -208 -1472 -208
WIRE -1376 -208 -1376 -240
WIRE -1376 -208 -1392 -208
WIRE -1248 -208 -1296 -208
WIRE -1008 -208 -1056 -208
WIRE -752 -192 -768 -192
WIRE -1744 -176 -1760 -176
WIRE -1664 -176 -1680 -176
WIRE -1536 -176 -1552 -176
WIRE -1456 -176 -1472 -176
WIRE -1344 -176 -1392 -176
WIRE -1280 -176 -1344 -176
WIRE -1168 -176 -1216 -176
WIRE -1040 -176 -1168 -176
WIRE -960 -176 -976 -176
WIRE -928 -176 -960 -176
WIRE -752 -160 -768 -160
WIRE -2048 -144 -2064 -144
WIRE -2016 -144 -2048 -144
WIRE -1824 -144 -1920 -144
WIRE -1376 -144 -1392 -144
WIRE -1296 -144 -1296 -208
WIRE -1248 -144 -1296 -144
WIRE -1056 -144 -1056 -208
WIRE -1008 -144 -1056 -144
WIRE -752 -128 -768 -128
WIRE -2208 -112 -2208 -208
WIRE -2064 -112 -2064 -144
WIRE -1376 -112 -1376 -144
WIRE -1344 -112 -1376 -112
WIRE -1280 -112 -1344 -112
WIRE -1152 -112 -1216 -112
WIRE -1040 -112 -1152 -112
WIRE -960 -112 -976 -112
WIRE -928 -112 -960 -112
WIRE -1712 -96 -1712 -128
WIRE -1712 -96 -1728 -96
WIRE -1168 -96 -1168 -176
WIRE -1152 -96 -1152 -112
WIRE -752 -96 -768 -96
WIRE -1296 -80 -1296 -144
WIRE -1248 -80 -1296 -80
WIRE -1056 -80 -1056 -144
WIRE -1008 -80 -1056 -80
WIRE -1792 -64 -1792 -96
WIRE -1504 -64 -1504 -128
WIRE -1504 -64 -1792 -64
WIRE -1200 -64 -1200 -240
WIRE -1056 -64 -1056 -80
WIRE -1296 -32 -1296 -80
WIRE -2192 32 -2208 32
WIRE -2096 32 -2192 32
WIRE -2080 32 -2096 32
WIRE -2000 32 -2016 32
WIRE -1984 32 -2000 32
WIRE -1904 32 -1920 32
WIRE -1792 32 -1792 -64
WIRE -1792 32 -1904 32
WIRE -2208 64 -2208 32
WIRE -1392 80 -1424 80
WIRE -1376 80 -1392 80
WIRE -1296 80 -1312 80
WIRE -1216 80 -1232 80
WIRE -1136 80 -1216 80
WIRE -1104 80 -1136 80
WIRE -912 80 -976 80
WIRE -2096 112 -2096 32
WIRE -1984 112 -2096 112
WIRE -1424 128 -1424 80
WIRE -1216 128 -1216 80
WIRE -1136 128 -1152 128
WIRE -1072 128 -1072 112
WIRE -1072 128 -1136 128
WIRE -1008 192 -1008 112
WIRE -2176 288 -2208 288
WIRE -2160 288 -2176 288
WIRE -2080 288 -2096 288
WIRE -1984 288 -2016 288
WIRE -1904 288 -1984 288
WIRE -1872 288 -1904 288
WIRE -1776 288 -1808 288
WIRE -1680 288 -1712 288
WIRE -1664 288 -1680 288
WIRE -1600 288 -1664 288
WIRE -1392 288 -1536 288
WIRE -1376 288 -1392 288
WIRE -1296 288 -1312 288
WIRE -1216 288 -1232 288
WIRE -1136 288 -1216 288
WIRE -1104 288 -1136 288
WIRE -2208 336 -2208 288
WIRE -1984 336 -1984 288
WIRE -1904 336 -1920 336
WIRE -1840 336 -1840 320
WIRE -1840 336 -1904 336
WIRE -1216 336 -1216 288
WIRE -1136 336 -1152 336
WIRE -1072 336 -1072 320
WIRE -1072 336 -1136 336
WIRE -1744 368 -1744 320
WIRE -1008 400 -1008 320
WIRE -2128 432 -2128 320
WIRE -1984 432 -2128 432
WIRE -1808 432 -1888 432
WIRE -1744 432 -1744 368
WIRE -2128 464 -2128 432
WIRE -1104 464 -1104 432
WIRE -1104 464 -1136 464
WIRE -1072 464 -1104 464
WIRE -944 464 -944 320
WIRE -944 464 -1008 464
WIRE -1776 480 -1776 464
WIRE -1760 480 -1776 480
WIRE -1664 480 -1664 288
FLAG -2208 -400 0
FLAG -2016 -960 UP
FLAG -2016 -912 0
FLAG -1456 -816 U
FLAG -2016 -544 UN
FLAG -2016 -496 0
FLAG -1760 -960 VP
FLAG -1760 -912 0
FLAG -1760 -544 VN
FLAG -1760 -496 0
FLAG -1456 -720 V
FLAG -2208 -1024 DC_P
FLAG -752 -256 UP
FLAG -752 -160 VN
FLAG -752 -224 UN
FLAG -752 -192 VP
FLAG -1536 -960 WP
FLAG -1536 -912 0
FLAG -1536 -544 WN
FLAG -1536 -496 0
FLAG -1456 -624 W
FLAG -752 -96 WN
FLAG -752 -128 WP
FLAG -2208 -32 0
FLAG -2064 -32 0
FLAG -2192 -208 iu
FLAG -2048 -144 iw
FLAG -1664 -208 id
FLAG -1664 -176 iq
FLAG -1392 80 id*
FLAG -1136 80 vd*_p
FLAG -1136 128 vd*_i
FLAG -1344 112 id
FLAG -1424 208 0
FLAG -912 80 vd*
FLAG -1392 288 iq*
FLAG -1136 288 vq*_p
FLAG -1136 336 vq*_i
FLAG -1344 320 iq
FLAG -912 288 vq*
FLAG -1552 -208 vd*
FLAG -1552 -176 vq*
FLAG -1424 -32 DC_P
FLAG -1344 -240 vu*
FLAG -1344 -176 vv*
FLAG -1344 -112 vw*
FLAG -960 -240 mu*
FLAG -960 -176 mv*
FLAG -960 -112 mw*
FLAG -1104 -608 0
FLAG -2208 144 0
FLAG -2192 32 om
FLAG -2000 32 pm
FLAG -1904 32 pe
FLAG -2176 288 om*
FLAG -1904 288 tm*_p
FLAG -1904 336 tm*_i
FLAG -2128 464 om
FLAG -2208 416 0
FLAG -1680 288 tm*
FLAG -1072 -768 tm
FLAG -1744 368 tm^_n
FLAG -1920 112 oe
FLAG -1136 464 oe
FLAG -1136 400 id
FLAG -1136 192 iq
FLAG -1104 224 oe
SYMBOL voltage -2208 -784 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value 100
SYMBOL diode -1904 -912 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL sw -1968 -880 M180
SYMATTR InstName S1
SYMBOL sw -1968 -464 M180
SYMATTR InstName S2
SYMBOL sw -1712 -880 M180
SYMATTR InstName S3
SYMBOL sw -1712 -464 M180
SYMATTR InstName S4
SYMBOL diode -1904 -480 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMBOL diode -1648 -912 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMBOL diode -1648 -480 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMBOL sw -1488 -880 M180
SYMATTR InstName S5
SYMBOL sw -1488 -464 M180
SYMATTR InstName S6
SYMBOL diode -1424 -912 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMBOL diode -1424 -480 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMBOL 3PhaseComplementaryPWM -928 -304 R0
WINDOW 123 8 265 Left 2
SYMATTR Value2 Tdelay=0 tripdt=100m*Tdead
SYMATTR InstName U1
SYMBOL bv -2208 -128 R0
SYMATTR InstName B1
SYMATTR Value V=I(L1)
SYMBOL bv -2064 -128 R0
SYMATTR InstName B2
SYMATTR Value V=I(L2)
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\uw-abTransformation -1824 -256 R0
SYMATTR InstName U2
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\xyRotation -1744 -256 R0
SYMATTR InstName U4
SYMBOL LTspiceControlLibrary\\Math\\Operands\\neg -1776 -64 R0
SYMATTR InstName U6
SYMBOL sub -1360 112 R0
SYMATTR InstName U7
SYMBOL Integral -1200 160 R0
SYMATTR Value T=5m
SYMATTR InstName U8
SYMBOL Proportional -1280 112 R0
SYMATTR Value K=10
SYMATTR InstName U10
SYMBOL add -1088 112 R0
SYMATTR InstName U11
SYMBOL voltage -1424 112 R0
SYMATTR InstName V2
SYMATTR Value {0*sqrt(3)}
SYMBOL sub -1360 320 R0
SYMATTR InstName U12
SYMBOL Integral -1200 368 R0
SYMATTR Value T=5m
SYMATTR InstName U13
SYMBOL Proportional -1280 320 R0
SYMATTR Value K=10
SYMATTR InstName U14
SYMBOL add -1088 320 R0
SYMATTR InstName U15
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\xyRotation -1536 -256 R0
SYMATTR InstName U16
SYMBOL LTspiceControlLibrary\\CoordinateTransformations\\ab-uvwTransformation -1456 -256 R0
SYMATTR InstName U17
SYMBOL LTspiceControlLibrary\\Math\\Operands\\rcp -1408 0 R0
SYMATTR InstName U3
SYMBOL LTspiceControlLibrary\\Math\\Operands\\mul -1264 -208 R0
SYMATTR InstName U18
SYMBOL LTspiceControlLibrary\\Math\\Operands\\mul -1264 -144 R0
SYMATTR InstName U19
SYMBOL LTspiceControlLibrary\\Math\\Operands\\mul -1264 -80 R0
SYMATTR InstName U20
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -1024 -208 R0
SYMATTR InstName U24
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -1024 -144 R0
SYMATTR InstName U25
SYMBOL LTspiceControlLibrary\\Math\\Operands\\sub -1024 -80 R0
SYMATTR InstName U26
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1344 0 R0
SYMATTR Value K=2
SYMATTR InstName U31
SYMBOL LTspiceControlLibrary\\TransferFunctions\\1stOrderLag -2000 -176 R0
SYMATTR Value K=1 T=50u
SYMATTR InstName U27
SYMBOL LTspiceControlLibrary\\TransferFunctions\\1stOrderLag -2000 -112 R0
SYMATTR Value K=1 T=50u
SYMATTR InstName U28
SYMBOL bv -2208 48 R0
SYMATTR InstName B3
SYMATTR Value V=I(V4)
SYMBOL voltage -1008 -768 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value PWL(0 0 10m 0 11m 3 20m 3 21m -3)
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Integral -2064 64 R0
SYMATTR InstName U9
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1968 64 R0
SYMATTR Value K=3
SYMATTR InstName U30
SYMBOL sub -2144 320 R0
SYMATTR InstName U29
SYMBOL Integral -1968 368 R0
SYMATTR InstName U32
SYMBOL Proportional -2064 320 R0
SYMATTR Value K=50m
SYMATTR InstName U33
SYMBOL add -1856 320 R0
SYMATTR InstName U34
SYMBOL voltage -2208 320 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V5
SYMATTR Value PULSE(0 100)
SYMBOL Proportional -1584 320 R0
SYMATTR Value K={1/(0.1*3)}
SYMATTR InstName U35
SYMBOL FerriteBead -1360 -816 R270
WINDOW 0 16 0 VTop 2
SYMATTR InstName L1
SYMATTR Value 1n
SYMBOL FerriteBead -1360 -624 R270
WINDOW 0 16 0 VTop 2
SYMATTR InstName L2
SYMATTR Value 1n
SYMBOL sub -1760 320 R0
SYMATTR InstName U37
SYMBOL LTspiceControlLibrary\\TransferFunctions\\1stOrderLag -1680 512 M0
WINDOW 3 67 5 Right 2
SYMATTR Value K=1 T=1m
SYMATTR InstName U41
SYMBOL sub -1792 464 R0
SYMATTR InstName U42
SYMBOL LTspiceControlLibrary\\TransferFunctions\\LaggedDerivative -1968 464 R0
SYMATTR Value i=1m/T T=0.1m
SYMATTR InstName U36
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1104 -32 R0
SYMATTR Value K=-0.5
SYMATTR InstName U43
SYMBOL LTspiceControlLibrary\\Math\\Functions\\mid -1184 -96 M180
SYMATTR InstName U21
SYMBOL LTspiceControlLibrary\\TransferFunctions\\Proportional -1968 144 R0
SYMATTR Value K=3
SYMATTR InstName U23
SYMBOL LTspiceControlLibrary\\Math\\Operands\\mul -1120 432 R0
SYMATTR InstName U38
SYMBOL Proportional -1056 432 R0
SYMATTR Value K=1m
SYMATTR InstName U39
SYMBOL add -1024 320 R0
SYMATTR InstName U40
SYMBOL Proportional -1056 496 R0
SYMATTR Value K=0.1
SYMATTR InstName U44
SYMBOL add -960 320 R0
SYMATTR InstName U45
SYMBOL add -1024 112 R0
SYMATTR InstName U46
SYMBOL LTspiceControlLibrary\\Math\\Operands\\mul -1120 224 R0
SYMATTR InstName U47
SYMBOL Proportional -1056 224 R0
SYMATTR Value K=-1m
SYMATTR InstName U48
SYMBOL LTspiceControlLibrary\\Motors\\PMSMotor -1120 -720 R0
SYMATTR InstName U5
TEXT -2216 -1184 Left 2 !.tran 40m startup
TEXT -2216 -1152 Left 2 !.model SW SW(Ron=1 Roff=1Meg Vt=0.5)\n.model D D(Ron=.1 Roff=1Meg Vfwd=.4)
TEXT -872 -288 Left 2 ;PWM
TEXT -2208 -288 Left 2 ;sensor
TEXT -2256 -1224 Left 4 ;Config
TEXT -2296 -1280 Left 5 ;PMSM Vector Control with 2 Currents and Speed Sensing
TEXT -2256 -1088 Left 4 ;Circuit
TEXT -2248 -328 Left 4 ;Controller
TEXT -1320 -472 Left 2 ;NOTE:\nIf you want to simulate the dead time of gate signals with accuracy,\nset maximum timestep of transient analysis below the dead time\nor set the parameter 'tripdt' of PWM below the dead time.\nSmaller value brings more accurate but slower simulation.
TEXT -1432 40 Left 2 ;current controller
TEXT -1824 -288 Left 2 ;coordinate transformation
TEXT -1248 -1072 Left 2 ;Analogy between\nElectric Circuit  - Rotating Machinery\nQ: charge - Pm: angle\nI: current - Om: angular velocity\nV: voltage - Tm: torque\nR: resistance - Dm: viscous resistance\nL: inductance - Jm: moment of inertia\nC: capacitance - Km: torsion coefficient
TEXT -2216 224 Left 2 ;speed controller
TEXT -936 -736 Left 2 ;disturbance torque
TEXT -2088 392 Left 2 ;disturbance observer
TEXT -1296 -288 Left 2 ;increasing voltage utilization
TEXT -1048 248 Left 2 ;decoupler
