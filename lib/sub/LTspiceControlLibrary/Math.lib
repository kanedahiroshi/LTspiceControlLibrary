** Math

.include LTspiceControlLibrary\Math.inc

* Functions built in arbitrary behavioral voltage

.subckt abs v x
B1 v 0 V=abs(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends abs

.subckt acos v x
B1 v 0 V=acos(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends acos

.subckt acosh v x
B1 v 0 V=acosh(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends acosh

.subckt asin v x
B1 v 0 V=asin(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends asin

.subckt asinh v x
B1 v 0 V=asinh(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends asinh

.subckt atan v x
B1 v 0 V=atan(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends atan

.subckt atan2 v y x
B1 v 0 V=atan2(V(y),V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends atan2

.subckt atanh v x
B1 v 0 V=atanh(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends atanh

.subckt buf v x
B1 v 0 V=buf(V(x)) tripdt={tripdt}
.param tripdt=1u
.ends buf

.subckt ceil v x
B1 v 0 V=ceil(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends ceil

.subckt cos v x
B1 v 0 V=cos(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends cos

.subckt cosh v x
B1 v 0 V=cosh(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends cosh

.subckt ddt v x
B1 v 0 V=ddt(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends ddt

.subckt delay v x
B1 v 0 V=delay(V(x),t) tripdt={tripdt} tripdv={tripdv}
.param t=1
.param tripdt=1e300 tripdv=1
.ends delay

.subckt delay2 v x t
B1 v 0 V=delay(V(x),V(t),tmax) tripdt={tripdt} tripdv={tripdv}
.param tmax=1T
.param tripdt=1e300 tripdv=1
.ends delay2

.subckt delay3 v x t tmax
B1 v 0 V=delay(V(x),V(t),V(tmax)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends delay3

.subckt exp v x
B1 v 0 V=exp(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends exp

.subckt floor v x
B1 v 0 V=floor(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends floor

.subckt hypot v x y
B1 v 0 V=hypot(V(x),V(y)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends hypot

.subckt idt v x
B1 v 0 V=idt(V(x),ic) tripdt={tripdt} tripdv={tripdv}
.param ic=0
.param tripdt=1e300 tripdv=1
.ends idt

.subckt idt2 v x ic a
B1 v 0 V=idt(V(x),V(ic),V(a)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends idt2

.subckt idtmod v x
B1 v 0 V=idtmod(V(x),ic,m,o) tripdt={tripdt} tripdv={tripdv}
.param ic=0 m=0 o=0
.param tripdt=1e300 tripdv=1
.ends idtmod

.subckt idtmod2 v x ic m o
B1 v 0 V=idtmod(V(x),V(ic),V(m),V(o)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends idtmod2

.subckt if v x y z
B1 v 0 V=if(V(x),V(y),V(z)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends if

.subckt int v x
B1 v 0 V=int(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends int

.subckt inv v x
B1 v 0 V=inv(V(x)) tripdt={tripdt}
.param tripdt=1u
.ends inv

.subckt limit v x
B1 v 0 V=limit(V(x),y,z) tripdt={tripdt} tripdv={tripdv}
.param y=-1T z=1T
.param tripdt=1e300 tripdv=1
.ends limit

.subckt mid v x y z
B1 v 0 V=limit(V(x),V(y),V(z)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends mid

.subckt ln v x
B1 v 0 V=ln(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends ln

.subckt log10 v x
B1 v 0 V=log10(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends log10

.subckt max v x y
B1 v 0 V=max(V(x),V(y)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends max

.subckt min v x y
B1 v 0 V=min(V(x),V(y)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends min

.subckt pow v x y
B1 v 0 V=pow(V(x),V(y)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends pow

.subckt pwr v x y
B1 v 0 V=pwr(V(x),V(y)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends pwr

.subckt pwrs v x y
B1 v 0 V=pwrs(V(x),V(y)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends pwrs

.subckt rand v x
B1 v 0 V=rand(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends rand

.subckt random v x
B1 v 0 V=random(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends random

.subckt round v x
B1 v 0 V=round(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends round

.subckt sgn v x
B1 v 0 V=sgn(V(x)) tripdt={tripdt}
.param tripdt=1u
.ends sgn

.subckt sin v x
B1 v 0 V=sin(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends sin

.subckt sinh v x
B1 v 0 V=sinh(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends sinh

.subckt sqrt v x
B1 v 0 V=sqrt(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends sqrt

.subckt tan v x
B1 v 0 V=tan(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends tan

.subckt tanh v x
B1 v 0 V=tanh(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends tanh

.subckt u v x
B1 v 0 V=u(V(x)) tripdt={tripdt}
.param tripdt=1u
.ends u

.subckt uramp v x
B1 v 0 V=uramp(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends uramp

.subckt white v x
B1 v 0 V=white(V(x)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends white

* Additional Functions

.subckt deadb v x
B1 v 0 V=deadb(V(x),y,z,b) tripdt={tripdt} tripdv={tripdv}
.param y=-z z=1
.param b=0
.param tripdt=1e300 tripdv=1
.ends deadb

.subckt mode v x y
B1 v 0 V=mode(V(x),V(y)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends mode

.subckt modf v x y
B1 v 0 V=modf(V(x),V(y)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends modf

.subckt modt v x y
B1 v 0 V=modt(V(x),V(y)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends modt

.subckt modr v x y
B1 v 0 V=modr(V(x),V(y)) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends modr

* Operands built in arbitrary behavioral voltage

.subckt and v x y
B1 v 0 V=V(x)&V(y) tripdt={tripdt}
.param tripdt=1u
.ends and

.subckt or v x y
B1 v 0 V=V(x)|V(y) tripdt={tripdt}
.param tripdt=1u
.ends or

.subckt xor v x y
B1 v 0 V=V(x)^V(y) tripdt={tripdt}
.param tripdt=1u
.ends xor

.subckt eq v x y
B1 v 0 V=V(x)==V(y) tripdt={tripdt}
.param tripdt=1u
.ends eq

.subckt neq v x y
B1 v 0 V=V(x)!=V(y) tripdt={tripdt}
.param tripdt=1u
.ends neq

.subckt nle v x y
B1 v 0 V=V(x)>V(y) tripdt={tripdt}
.param tripdt=1u
.ends nle

.subckt lt v x y
B1 v 0 V=V(x)<V(y) tripdt={tripdt}
.param tripdt=1u
.ends lt

.subckt nlt v x y
B1 v 0 V=V(x)>=V(y) tripdt={tripdt}
.param tripdt=1u
.ends nlt

.subckt le v x y
B1 v 0 V=V(x)<=V(y) tripdt={tripdt}
.param tripdt=1u
.ends le

.subckt add v x y
E1 ny 0 0 y 1
E2 v 0 x ny 1
.ends add

.subckt sub v x y
E1 v 0 x y 1
.ends sub

.subckt mul v x y
B1 v 0 V=V(x)*V(y) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends mul

.subckt div v x y
B1 v 0 V=V(x)/V(y) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends div

* Additional Operands

.subckt neg v x
E1 v 0 0 x 1
.ends neg

.subckt rcp v x
B1 v 0 V=1/V(x) tripdt={tripdt} tripdv={tripdv}
.param tripdt=1e300 tripdv=1
.ends rcp

.subckt inc v x
V1 0 nk 1
E1 v 0 x nk 1
.ends inc

.subckt dec v x
V1 0 nk -1
E1 v 0 x nk 1
.ends dec

.subckt addk v x
V1 0 nk {k}
E1 v 0 x nk 1
.param k=0
.ends addk
